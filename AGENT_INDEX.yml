version: 1
language: csharp
unity:
  asmdef_paths: []
maintenance:
  update_when:
    - Add, remove, or rename entrypoint files/classes/methods in runtime or test projects.
    - Change build/test wiring, project references, or central MSBuild policies.
    - Introduce new canonical extension points to avoid duplicate implementations.
  generation_notes:
    - Verify symbols directly in source files before adding or modifying entries.
    - Keep modules curated around canonical runtime, build, and test roots.
    - When configuration APIs are edited, keep XMLDOC coverage complete across touched identifiers.
conventions:
  - Treat warnings as errors globally via central MSBuild props.
  - Use xUnit for unit tests and keep reusable fixtures/helpers in a shared test project.
  - Prefer extending existing orchestration/test roots over creating parallel frameworks.
  - Keep XMLDOC comments detailed for runtime and configuration APIs so intent/usage are clear in-code.
modules:
  - id: application-hosting
    summary: Runtime host orchestration that bootstraps configuration, initializes logging, and handles fatal paths.
    tags: [application, hosting, runtime]
    paths:
      - SuwayomiSourceMerge/Application/Hosting/ApplicationHost.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Hosting/ApplicationHostTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/ProgramEntryPointTests.cs
    entrypoints:
      - symbol: ApplicationHost
        kind: class
        path: SuwayomiSourceMerge/Application/Hosting/ApplicationHost.cs
        purpose: Coordinates bootstrap, logger creation, lifecycle events, and failure handling.
      - symbol: ApplicationHost.CreateDefault
        kind: method
        path: SuwayomiSourceMerge/Application/Hosting/ApplicationHost.cs
        purpose: Builds the default production composition of bootstrap and logging services.
      - symbol: ApplicationHost.Run
        kind: method
        path: SuwayomiSourceMerge/Application/Hosting/ApplicationHost.cs
        purpose: Executes host startup/shutdown flow and writes stderr fallback diagnostics on failures.
      - symbol: ApplicationHostTests
        kind: class
        path: tests/SuwayomiSourceMerge.UnitTests/Application/Hosting/ApplicationHostTests.cs
        purpose: Verifies success, bootstrap failure, unhandled exception, and level-none host behavior.
    extension_points:
      - how: Add or adjust host lifecycle events and shutdown behavior in the run pipeline.
        symbols: [ApplicationHost.Run]
        paths: [SuwayomiSourceMerge/Application/Hosting/ApplicationHost.cs]
      - how: Swap runtime composition dependencies by extending the default host factory method.
        symbols: [ApplicationHost.CreateDefault]
        paths: [SuwayomiSourceMerge/Application/Hosting/ApplicationHost.cs]
    do_not_reimplement:
      - Canonical host lifecycle orchestration and stderr fallback handling; use ApplicationHost.Run.
      - Canonical runtime dependency composition for bootstrap and logging; use ApplicationHost.CreateDefault.
    related: [logging-infrastructure, runtime-host, unit-test-suite]
  - id: build-and-quality
    summary: Central build defaults and formatting behavior for the solution.
    tags: [build, msbuild, quality]
    paths:
      - .editorconfig
      - Directory.Build.props
      - SuwayomiSourceMerge/AssemblyInfo.cs
      - SuwayomiSourceMerge/SuwayomiSourceMerge.csproj
    entrypoints:
      - symbol: .editorconfig
        kind: file
        path: .editorconfig
        purpose: Defines canonical repository code style and naming conventions.
      - symbol: CleanupFormatLock
        kind: method
        path: SuwayomiSourceMerge/SuwayomiSourceMerge.csproj
        purpose: Removes the formatting lock file after build completion.
      - symbol: Directory.Build.props
        kind: file
        path: Directory.Build.props
        purpose: Defines solution-wide warning policy.
      - symbol: FormatCode
        kind: method
        path: SuwayomiSourceMerge/SuwayomiSourceMerge.csproj
        purpose: Runs dotnet format before compilation when enabled.
      - symbol: SuwayomiSourceMerge/AssemblyInfo.cs
        kind: file
        path: SuwayomiSourceMerge/AssemblyInfo.cs
        purpose: Declares assembly-level test visibility for internal runtime types.
    extension_points:
      - how: Add or adjust global build quality policies in the shared props file.
        symbols: [Directory.Build.props]
        paths: [Directory.Build.props]
      - how: Adjust C# formatting and naming conventions in the repository editorconfig.
        symbols: [.editorconfig]
        paths: [.editorconfig]
      - how: Adjust internal test visibility through assembly attributes instead of exposing runtime internals publicly.
        symbols: [SuwayomiSourceMerge/AssemblyInfo.cs]
        paths: [SuwayomiSourceMerge/AssemblyInfo.cs]
      - how: Adjust formatting behavior by editing build targets and conditions in the app project file.
        symbols: [CleanupFormatLock, FormatCode]
        paths: [SuwayomiSourceMerge/SuwayomiSourceMerge.csproj]
    do_not_reimplement:
      - Code formatting and naming conventions; use .editorconfig.
      - Global warnings-as-errors behavior; use Directory.Build.props.
      - Post-build formatting lock cleanup; use CleanupFormatLock.
      - Pre-build formatting orchestration; use FormatCode.
      - Test assembly internal visibility policy; use SuwayomiSourceMerge/AssemblyInfo.cs.
    related: [runtime-host, unit-test-suite]
  - id: config-bootstrap-migration
    summary: Bootstrap orchestration that creates missing YAML, migrates legacy text, and self-heals settings values.
    tags: [bootstrap, config, migration, yaml]
    paths:
      - SuwayomiSourceMerge/Configuration/Bootstrap/ConfigurationBootstrapException.cs
      - SuwayomiSourceMerge/Configuration/Bootstrap/ConfigurationBootstrapFileState.cs
      - SuwayomiSourceMerge/Configuration/Bootstrap/ConfigurationBootstrapResult.cs
      - SuwayomiSourceMerge/Configuration/Bootstrap/ConfigurationBootstrapService.cs
      - SuwayomiSourceMerge/Configuration/Bootstrap/ConfigurationBootstrapWarning.cs
      - SuwayomiSourceMerge/Configuration/Bootstrap/ConfigurationDocumentSet.cs
      - SuwayomiSourceMerge/Configuration/Bootstrap/ConfigurationPathSet.cs
      - SuwayomiSourceMerge/Configuration/Bootstrap/IConfigurationBootstrapService.cs
      - SuwayomiSourceMerge/Configuration/Bootstrap/LegacyMangaEquivalentsMigrator.cs
      - SuwayomiSourceMerge/Configuration/Bootstrap/LegacyMigrationResult.cs
      - SuwayomiSourceMerge/Configuration/Bootstrap/LegacySourcePriorityMigrator.cs
      - SuwayomiSourceMerge/Configuration/Bootstrap/SettingsSelfHealingResult.cs
      - SuwayomiSourceMerge/Configuration/Bootstrap/SettingsSelfHealingService.cs
      - SuwayomiSourceMerge/Configuration/Bootstrap/YamlDocumentWriter.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Bootstrap/ConfigurationBootstrapExceptionTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Bootstrap/ConfigurationBootstrapGuardTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Bootstrap/ConfigurationBootstrapServiceTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Bootstrap/ConfigurationBootstrapServiceSceneTagValidationTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Bootstrap/ConfigurationPathSetTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Bootstrap/LegacyMangaEquivalentsMigratorTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Bootstrap/LegacySourcePriorityMigratorTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Bootstrap/SettingsSelfHealingServiceTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Bootstrap/YamlDocumentWriterTests.cs
    entrypoints:
      - symbol: ConfigurationBootstrapException
        kind: class
        path: SuwayomiSourceMerge/Configuration/Bootstrap/ConfigurationBootstrapException.cs
        purpose: Represents bootstrap failures caused by validation errors.
      - symbol: ConfigurationBootstrapResult
        kind: class
        path: SuwayomiSourceMerge/Configuration/Bootstrap/ConfigurationBootstrapResult.cs
        purpose: Returns validated documents, file-state metadata, and migration warnings.
      - symbol: ConfigurationBootstrapService
        kind: class
        path: SuwayomiSourceMerge/Configuration/Bootstrap/ConfigurationBootstrapService.cs
        purpose: Coordinates file creation, legacy migration, and final parse-and-validate loading.
      - symbol: ConfigurationBootstrapService.Bootstrap
        kind: method
        path: SuwayomiSourceMerge/Configuration/Bootstrap/ConfigurationBootstrapService.cs
        purpose: Executes per-file bootstrap decisions and throws on any validation errors.
      - symbol: IConfigurationBootstrapService
        kind: interface
        path: SuwayomiSourceMerge/Configuration/Bootstrap/IConfigurationBootstrapService.cs
        purpose: Defines the canonical bootstrap entrypoint for runtime orchestration.
      - symbol: SettingsSelfHealingService
        kind: class
        path: SuwayomiSourceMerge/Configuration/Bootstrap/SettingsSelfHealingService.cs
        purpose: Fills missing settings keys from defaults while preserving existing values.
    extension_points:
      - how: Add cross-document validation rules that depend on multiple parsed config documents inside bootstrap orchestration.
        symbols: [ConfigurationBootstrapService, ConfigurationBootstrapService.Bootstrap]
        paths: [SuwayomiSourceMerge/Configuration/Bootstrap/ConfigurationBootstrapService.cs]
      - how: Add support for new legacy file formats by adding migrators and wiring them into bootstrap service decisions.
        symbols: [ConfigurationBootstrapService, LegacyMangaEquivalentsMigrator, LegacySourcePriorityMigrator]
        paths: [SuwayomiSourceMerge/Configuration/Bootstrap/ConfigurationBootstrapService.cs, SuwayomiSourceMerge/Configuration/Bootstrap/LegacyMangaEquivalentsMigrator.cs, SuwayomiSourceMerge/Configuration/Bootstrap/LegacySourcePriorityMigrator.cs]
      - how: Extend bootstrap result diagnostics by adding metadata fields to result and warning records consumed by callers.
        symbols: [ConfigurationBootstrapFileState, ConfigurationBootstrapResult, ConfigurationBootstrapWarning]
        paths: [SuwayomiSourceMerge/Configuration/Bootstrap/ConfigurationBootstrapFileState.cs, SuwayomiSourceMerge/Configuration/Bootstrap/ConfigurationBootstrapResult.cs, SuwayomiSourceMerge/Configuration/Bootstrap/ConfigurationBootstrapWarning.cs]
      - how: Extend settings self-heal merge policy by editing the section and field coalescing logic in the self-heal service.
        symbols: [SettingsSelfHealingService]
        paths: [SuwayomiSourceMerge/Configuration/Bootstrap/SettingsSelfHealingService.cs]
      - how: Update canonical config file locations by editing ConfigurationPathSet instead of hardcoding names in callers.
        symbols: [ConfigurationPathSet]
        paths: [SuwayomiSourceMerge/Configuration/Bootstrap/ConfigurationPathSet.cs]
    do_not_reimplement:
      - Canonical legacy manga-equivalents parsing and warning behavior; use LegacyMangaEquivalentsMigrator.
      - Canonical legacy source-priority parsing behavior; use LegacySourcePriorityMigrator.
      - Canonical scene-tag-aware cross-document manga-equivalents validation in bootstrap; use ConfigurationBootstrapService.Bootstrap.
      - Canonical settings self-heal merge behavior; use SettingsSelfHealingService.
      - Canonical YAML bootstrap write format; use YamlDocumentWriter.
      - Per-file bootstrap orchestration and validation failure policy; use ConfigurationBootstrapService.Bootstrap.
    related: [config-schema-validation, domain-normalization, runtime-host, unit-test-suite]
  - id: config-resolution
    summary: YAML-backed canonical title, source-priority, and override-title resolution services with frozen normalized lookups for runtime grouping flows.
    tags: [config, priority, resolution, titles]
    paths:
      - SuwayomiSourceMerge/Configuration/Resolution/IMangaEquivalenceService.cs
      - SuwayomiSourceMerge/Configuration/Resolution/IOverrideCanonicalResolver.cs
      - SuwayomiSourceMerge/Configuration/Resolution/ISourcePriorityService.cs
      - SuwayomiSourceMerge/Configuration/Resolution/MangaEquivalenceService.cs
      - SuwayomiSourceMerge/Configuration/Resolution/OverrideCanonicalResolver.cs
      - SuwayomiSourceMerge/Configuration/Resolution/SourcePriorityService.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Resolution/MangaEquivalenceServiceTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Resolution/OverrideCanonicalResolverTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Resolution/SourcePriorityServiceTests.cs
    entrypoints:
      - symbol: IMangaEquivalenceService
        kind: interface
        path: SuwayomiSourceMerge/Configuration/Resolution/IMangaEquivalenceService.cs
        purpose: Defines canonical title resolution operations over YAML equivalence mappings.
      - symbol: IOverrideCanonicalResolver
        kind: interface
        path: SuwayomiSourceMerge/Configuration/Resolution/IOverrideCanonicalResolver.cs
        purpose: Defines exact override-title resolution behavior for unmatched equivalence titles.
      - symbol: ISourcePriorityService
        kind: interface
        path: SuwayomiSourceMerge/Configuration/Resolution/ISourcePriorityService.cs
        purpose: Defines source-priority lookup behavior for normalized source names.
      - symbol: MangaEquivalenceService
        kind: class
        path: SuwayomiSourceMerge/Configuration/Resolution/MangaEquivalenceService.cs
        purpose: Builds frozen canonical title lookups from canonical and alias mappings with fail-fast conflict checks.
      - symbol: OverrideCanonicalResolver
        kind: class
        path: SuwayomiSourceMerge/Configuration/Resolution/OverrideCanonicalResolver.cs
        purpose: Resolves normalized title keys to first-seen exact override titles via frozen lookup data.
      - symbol: SourcePriorityService
        kind: class
        path: SuwayomiSourceMerge/Configuration/Resolution/SourcePriorityService.cs
        purpose: Resolves normalized source keys to configured priority indexes with deterministic fallback handling and frozen lookups.
    extension_points:
      - how: Add additional resolution behavior by extending service interfaces and implementations in the resolution module.
        symbols: [IMangaEquivalenceService, IOverrideCanonicalResolver, ISourcePriorityService, MangaEquivalenceService, OverrideCanonicalResolver, SourcePriorityService]
        paths: [SuwayomiSourceMerge/Configuration/Resolution/IMangaEquivalenceService.cs, SuwayomiSourceMerge/Configuration/Resolution/IOverrideCanonicalResolver.cs, SuwayomiSourceMerge/Configuration/Resolution/ISourcePriorityService.cs, SuwayomiSourceMerge/Configuration/Resolution/MangaEquivalenceService.cs, SuwayomiSourceMerge/Configuration/Resolution/OverrideCanonicalResolver.cs, SuwayomiSourceMerge/Configuration/Resolution/SourcePriorityService.cs]
      - how: Swap scene-tag-aware normalization behavior by injecting alternate ISceneTagMatcher implementations into title-based resolvers.
        symbols: [MangaEquivalenceService, OverrideCanonicalResolver, ISceneTagMatcher]
        paths: [SuwayomiSourceMerge/Configuration/Resolution/MangaEquivalenceService.cs, SuwayomiSourceMerge/Configuration/Resolution/OverrideCanonicalResolver.cs, SuwayomiSourceMerge/Domain/Normalization/ISceneTagMatcher.cs]
      - how: Wire runtime grouping or mount pipelines to these lookup services via interfaces instead of duplicating dictionary-building logic.
        symbols: [IMangaEquivalenceService, IOverrideCanonicalResolver, ISourcePriorityService]
        paths: [SuwayomiSourceMerge/Configuration/Resolution/IMangaEquivalenceService.cs, SuwayomiSourceMerge/Configuration/Resolution/IOverrideCanonicalResolver.cs, SuwayomiSourceMerge/Configuration/Resolution/ISourcePriorityService.cs]
    do_not_reimplement:
      - Canonical manga equivalence canonical/alias lookup construction and conflict checks; use MangaEquivalenceService.
      - Canonical override-title normalized lookup with caller-order-first collision policy; use OverrideCanonicalResolver.
      - Canonical source-priority normalized token matching and fallback behavior; use SourcePriorityService.
    related: [config-schema-validation, domain-normalization, unit-test-suite]
  - id: config-schema-validation
    summary: Strongly typed YAML schema parsing, defaults, and deterministic validation rules.
    tags: [config, yaml, validation]
    paths:
      - SuwayomiSourceMerge/Configuration/Documents/MangaEquivalentsDocument.cs
      - SuwayomiSourceMerge/Configuration/Documents/MangaEquivalentsDocumentDefaults.cs
      - SuwayomiSourceMerge/Configuration/Documents/SceneTagsDocument.cs
      - SuwayomiSourceMerge/Configuration/Documents/SceneTagsDocumentDefaults.cs
      - SuwayomiSourceMerge/Configuration/Documents/SettingsDocument.cs
      - SuwayomiSourceMerge/Configuration/Documents/SettingsDocumentDefaults.cs
      - SuwayomiSourceMerge/Configuration/Documents/SourcePriorityDocument.cs
      - SuwayomiSourceMerge/Configuration/Documents/SourcePriorityDocumentDefaults.cs
      - SuwayomiSourceMerge/Configuration/Loading/ConfigurationSchemaService.cs
      - SuwayomiSourceMerge/Configuration/Loading/ConfigurationValidationPipeline.cs
      - SuwayomiSourceMerge/Configuration/Loading/ParsedDocument.cs
      - SuwayomiSourceMerge/Configuration/Loading/YamlDocumentParser.cs
      - SuwayomiSourceMerge/Configuration/Validation/IConfigValidator.cs
      - SuwayomiSourceMerge/Configuration/Validation/MangaEquivalentsDocumentValidator.cs
      - SuwayomiSourceMerge/Configuration/Validation/SceneTagsDocumentValidator.cs
      - SuwayomiSourceMerge/Configuration/Validation/SettingsDocumentValidator.cs
      - SuwayomiSourceMerge/Configuration/Validation/SourcePriorityDocumentValidator.cs
      - SuwayomiSourceMerge/Configuration/Validation/ValidationError.cs
      - SuwayomiSourceMerge/Configuration/Validation/ValidationKeyNormalizer.cs
      - SuwayomiSourceMerge/Configuration/Validation/ValidationResult.cs
      - docs/config-schema.md
    entrypoints:
      - symbol: ConfigurationSchemaService
        kind: class
        path: SuwayomiSourceMerge/Configuration/Loading/ConfigurationSchemaService.cs
        purpose: Provides parse-and-validate entrypoints for all configuration files.
      - symbol: SettingsDocument
        kind: class
        path: SuwayomiSourceMerge/Configuration/Documents/SettingsDocument.cs
        purpose: Canonical sectioned schema model for settings.yml.
      - symbol: SettingsDocumentDefaults.Create
        kind: method
        path: SuwayomiSourceMerge/Configuration/Documents/SettingsDocumentDefaults.cs
        purpose: Produces default container-oriented settings values.
      - symbol: SettingsDocumentValidator
        kind: class
        path: SuwayomiSourceMerge/Configuration/Validation/SettingsDocumentValidator.cs
        purpose: Enforces deterministic settings validation rules via documented helper routines and emits actionable, path-scoped errors.
      - symbol: YamlDocumentParser
        kind: class
        path: SuwayomiSourceMerge/Configuration/Loading/YamlDocumentParser.cs
        purpose: Parses YAML into strongly typed documents and reports parser errors.
    extension_points:
      - how: Add new configuration files by introducing typed documents plus dedicated validators wired through the schema service.
        symbols: [ConfigurationSchemaService, IConfigValidator]
        paths: [SuwayomiSourceMerge/Configuration/Loading/ConfigurationSchemaService.cs, SuwayomiSourceMerge/Configuration/Validation/IConfigValidator.cs]
      - how: Adjust default scene-tag coverage by updating the defaults factory consumed during bootstrap file creation.
        symbols: [SceneTagsDocumentDefaults.Create]
        paths: [SuwayomiSourceMerge/Configuration/Documents/SceneTagsDocumentDefaults.cs]
      - how: Extend title-key normalization behavior by changing the domain normalizer and keeping the validation adapter in sync.
        symbols: [TitleKeyNormalizer.NormalizeTitleKey, ValidationKeyNormalizer]
        paths: [SuwayomiSourceMerge/Configuration/Validation/ValidationKeyNormalizer.cs, SuwayomiSourceMerge/Domain/Normalization/TitleKeyNormalizer.cs]
      - how: Extend settings shape by adding fields to document sections, defaults, and validator rules in lockstep.
        symbols: [SettingsDocument, SettingsDocumentDefaults.Create, SettingsDocumentValidator]
        paths: [SuwayomiSourceMerge/Configuration/Documents/SettingsDocument.cs, SuwayomiSourceMerge/Configuration/Documents/SettingsDocumentDefaults.cs, SuwayomiSourceMerge/Configuration/Validation/SettingsDocumentValidator.cs]
      - how: Update schema documentation and validation code catalog when rule sets change.
        symbols: [config-schema.md]
        paths: [docs/config-schema.md]
    do_not_reimplement:
      - Canonical matcher-aware title key normalization with trailing scene-tag suffix stripping; use TitleKeyNormalizer.NormalizeTitleKey.
      - Canonical default scene-tag list creation used for missing scene_tags.yml bootstrap; use SceneTagsDocumentDefaults.Create.
      - Canonical YAML parser behavior and parser error codes; use YamlDocumentParser.
      - Document-level parse-and-validate orchestration; use ConfigurationSchemaService.
      - Manga equivalents conflict detection rules; use MangaEquivalentsDocumentValidator.
      - Scene tag matcher-equivalent dedup rules; use SceneTagsDocumentValidator.
      - Settings logging level and logging section validation rules; use SettingsDocumentValidator.
      - Settings validation code map and field constraints; use SettingsDocumentValidator.
      - Source priority dedup validation rules; use SourcePriorityDocumentValidator.
      - YAML parser unknown-key tolerance for schema evolution; use YamlDocumentParser.
    related: [config-resolution, domain-normalization, logging-infrastructure, runtime-host, unit-test-suite]
  - id: domain-normalization
    summary: Data-driven scene-tag phrase matching used by title normalization and cross-document validation flows.
    tags: [domain, normalization, titles]
    paths:
      - SuwayomiSourceMerge/Domain/Normalization/ComparisonTextNormalizer.cs
      - SuwayomiSourceMerge/Domain/Normalization/ISceneTagMatcher.cs
      - SuwayomiSourceMerge/Domain/Normalization/SceneTagMatchKey.cs
      - SuwayomiSourceMerge/Domain/Normalization/SceneTagMatchKeyBuilder.cs
      - SuwayomiSourceMerge/Domain/Normalization/SceneTagMatchKeyKind.cs
      - SuwayomiSourceMerge/Domain/Normalization/SceneTagMatcher.cs
      - SuwayomiSourceMerge/Domain/Normalization/TitleKeyNormalizer.cs
      - tests/SuwayomiSourceMerge.UnitTests/Domain/Normalization/ComparisonTextNormalizerTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Domain/Normalization/SceneTagMatcherTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Domain/Normalization/TitleKeyNormalizerTests.cs
    entrypoints:
      - symbol: ComparisonTextNormalizer.NormalizeTokenKey
        kind: method
        path: SuwayomiSourceMerge/Domain/Normalization/ComparisonTextNormalizer.cs
        purpose: Builds lower-case ASCII token comparison keys with punctuation-insensitive separator handling.
      - symbol: ISceneTagMatcher
        kind: interface
        path: SuwayomiSourceMerge/Domain/Normalization/ISceneTagMatcher.cs
        purpose: Defines canonical phrase matching for configured scene tags.
      - symbol: SceneTagMatchKeyBuilder.TryCreate
        kind: method
        path: SuwayomiSourceMerge/Domain/Normalization/SceneTagMatchKeyBuilder.cs
        purpose: Produces matcher-equivalent token or punctuation keys for tags and candidates.
      - symbol: SceneTagMatcher
        kind: class
        path: SuwayomiSourceMerge/Domain/Normalization/SceneTagMatcher.cs
        purpose: Normalizes configured scene tags into matcher-equivalent keys and performs deterministic candidate matching.
      - symbol: SceneTagMatcher.IsMatch
        kind: method
        path: SuwayomiSourceMerge/Domain/Normalization/SceneTagMatcher.cs
        purpose: Returns whether a candidate phrase matches one normalized configured scene tag.
      - symbol: TitleKeyNormalizer.NormalizeTitleKey
        kind: method
        path: SuwayomiSourceMerge/Domain/Normalization/TitleKeyNormalizer.cs
        purpose: Builds compact title comparison keys with optional scene-tag suffix stripping.
    extension_points:
      - how: Add alternate scene-tag matching policies by implementing the matcher interface and injecting the implementation into validation call sites.
        symbols: [ISceneTagMatcher, MangaEquivalentsDocumentValidator]
        paths: [SuwayomiSourceMerge/Configuration/Validation/MangaEquivalentsDocumentValidator.cs, SuwayomiSourceMerge/Domain/Normalization/ISceneTagMatcher.cs]
      - how: Extend scene-tag key classification and normalization semantics in one place via the shared key builder.
        symbols: [SceneTagMatchKeyBuilder.TryCreate, SceneTagMatcher, SceneTagsDocumentValidator]
        paths: [SuwayomiSourceMerge/Configuration/Validation/SceneTagsDocumentValidator.cs, SuwayomiSourceMerge/Domain/Normalization/SceneTagMatchKeyBuilder.cs, SuwayomiSourceMerge/Domain/Normalization/SceneTagMatcher.cs]
      - how: Reuse shared punctuation/ASCII/token normalization primitives across validators and domain matchers.
        symbols: [ComparisonTextNormalizer.NormalizeTokenKey, SceneTagMatchKeyBuilder.TryCreate, TitleKeyNormalizer.NormalizeTokenKey]
        paths: [SuwayomiSourceMerge/Domain/Normalization/ComparisonTextNormalizer.cs, SuwayomiSourceMerge/Domain/Normalization/SceneTagMatchKeyBuilder.cs, SuwayomiSourceMerge/Domain/Normalization/TitleKeyNormalizer.cs]
    do_not_reimplement:
      - Canonical ASCII-fold + punctuation-insensitive token key normalization; use ComparisonTextNormalizer.NormalizeTokenKey.
      - Canonical configured scene-tag phrase matching implementation; use SceneTagMatcher.
      - Canonical matcher-equivalent scene-tag key derivation; use SceneTagMatchKeyBuilder.TryCreate.
      - Canonical scene-tag matcher contract for normalization consumers; use ISceneTagMatcher.
      - Canonical title key normalization for runtime and validation call sites; use TitleKeyNormalizer.NormalizeTitleKey.
    related: [config-bootstrap-migration, config-resolution, config-schema-validation, unit-test-suite]
  - id: infrastructure-branch-planning
    summary: Deterministic branch-link planning with strict path containment for ordering, naming, and mount identity.
    tags: [branching, infrastructure, mergerfs, mounts]
    paths:
      - SuwayomiSourceMerge/Infrastructure/Mounts/BranchIdentityService.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/BranchLinkNamingPolicy.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/IMergerfsBranchPlanningService.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/MergerfsBranchAccessMode.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/MergerfsBranchLinkDefinition.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/MergerfsBranchPlan.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/MergerfsBranchPlanningRequest.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/MergerfsBranchPlanningService.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/MergerfsSourceBranchCandidate.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/OverrideBranchSelectionEntry.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/OverrideBranchSelectionResult.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/OverrideBranchSelectionService.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/PathSafetyPolicy.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/SourceBranchOrderingService.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Mounts/BranchIdentityServiceTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Mounts/BranchLinkNamingPolicyTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Mounts/MergerfsBranchPlanningModelsTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Mounts/MergerfsBranchPlanningServiceTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Mounts/OverrideBranchSelectionResultTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Mounts/OverrideBranchSelectionServiceTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Mounts/PathSafetyPolicyTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Mounts/SourceBranchOrderingServiceTests.cs
    entrypoints:
      - symbol: BranchIdentityService
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Mounts/BranchIdentityService.cs
        purpose: Builds deterministic group ids and desired identity tokens from group keys and branch specifications.
      - symbol: BranchLinkNamingPolicy
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Mounts/BranchLinkNamingPolicy.cs
        purpose: Produces deterministic filesystem-safe link names with bounded label length and hash-truncation for override/source branches.
      - symbol: IMergerfsBranchPlanningService
        kind: interface
        path: SuwayomiSourceMerge/Infrastructure/Mounts/IMergerfsBranchPlanningService.cs
        purpose: Defines the canonical planner contract for mergerfs branch-link plan generation.
      - symbol: MergerfsBranchPlanningService.Plan
        kind: method
        path: SuwayomiSourceMerge/Infrastructure/Mounts/MergerfsBranchPlanningService.cs
        purpose: Emits ordered branch-link definitions, branch specification string, preferred override path, and desired identity token.
      - symbol: OverrideBranchSelectionService
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Mounts/OverrideBranchSelectionService.cs
        purpose: Chooses preferred override branch (`priority` first) with deterministic case-variant dedupe and includes additional existing override title paths.
      - symbol: PathSafetyPolicy
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Mounts/PathSafetyPolicy.cs
        purpose: Centralizes deterministic link-name safety, reusable fully-qualified path normalization, dot-segment escaping, and strict child-only containment for planner paths.
    extension_points:
      - how: Add alternate source-branch ordering and de-duplication policies by extending source ordering service behavior.
        symbols: [ISourcePriorityService, SourceBranchOrderingService, SourceBranchOrderingService.Order]
        paths: [SuwayomiSourceMerge/Configuration/Resolution/ISourcePriorityService.cs, SuwayomiSourceMerge/Infrastructure/Mounts/SourceBranchOrderingService.cs]
      - how: Adjust deterministic identity-token generation by editing group-id and branch-hash rules in branch identity service.
        symbols: [BranchIdentityService, BranchIdentityService.BuildDesiredIdentity]
        paths: [SuwayomiSourceMerge/Infrastructure/Mounts/BranchIdentityService.cs]
      - how: Centralize future dot-segment escaping and containment policy changes in the shared path safety helper.
        symbols: [OverrideBranchSelectionService, PathSafetyPolicy]
        paths: [SuwayomiSourceMerge/Infrastructure/Mounts/OverrideBranchSelectionService.cs, SuwayomiSourceMerge/Infrastructure/Mounts/PathSafetyPolicy.cs]
      - how: Extend override volume selection and additional-branch inclusion policy in override branch selection service.
        symbols: [OverrideBranchSelectionService, OverrideBranchSelectionService.Select]
        paths: [SuwayomiSourceMerge/Infrastructure/Mounts/OverrideBranchSelectionService.cs]
    do_not_reimplement:
      - Canonical deterministic branch identity token generation; use BranchIdentityService.
      - Canonical deterministic branch-link naming with component-length-safe hash-truncation for override/source branches; use BranchLinkNamingPolicy.
      - Canonical deterministic branch-link planning facade output (order, RW/RO, spec, identity); use MergerfsBranchPlanningService.Plan.
      - Canonical override preferred-volume selection with deterministic case-variant representative dedupe + additional-existing-override inclusion; use OverrideBranchSelectionService.
      - Canonical deterministic link-name invalid-character/trailing-dot-space validation plus fully-qualified path normalization, dot-segment escaping, path equality, and strict child-only containment; use PathSafetyPolicy.
      - Canonical source-priority ordering and duplicate-path coalescing for source branches; use SourceBranchOrderingService.Order.
      - Canonical separator-safe title/link validation for planner request and link models; use MergerfsBranchPlanningRequest and MergerfsBranchLinkDefinition.
    related: [config-resolution, infrastructure-mounts, infrastructure-volumes, unit-test-suite]
  - id: infrastructure-metadata
    summary: Override metadata seeding and ComicInfo fallback parsing that produces shell-parity details.json payloads.
    tags: [comicinfo, details, infrastructure, metadata]
    paths:
      - SuwayomiSourceMerge/Infrastructure/Metadata/ComicInfoMetadata.cs
      - SuwayomiSourceMerge/Infrastructure/Metadata/ComicInfoMetadataParser.cs
      - SuwayomiSourceMerge/Infrastructure/Metadata/IComicInfoMetadataParser.cs
      - SuwayomiSourceMerge/Infrastructure/Metadata/IOverrideDetailsService.cs
      - SuwayomiSourceMerge/Infrastructure/Metadata/OverrideDetailsOutcome.cs
      - SuwayomiSourceMerge/Infrastructure/Metadata/OverrideDetailsRequest.cs
      - SuwayomiSourceMerge/Infrastructure/Metadata/OverrideDetailsResult.cs
      - SuwayomiSourceMerge/Infrastructure/Metadata/OverrideDetailsService.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Metadata/ComicInfoMetadataParserTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Metadata/OverrideDetailsServiceTests.cs
    entrypoints:
      - symbol: ComicInfoMetadataParser
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Metadata/ComicInfoMetadataParser.cs
        purpose: Parses ComicInfo files with strict XDocument parsing (including inline Summary break-markup preservation) first and tolerant line-scanner fallback for malformed XML.
      - symbol: ComicInfoMetadataParser.TryParse
        kind: method
        path: SuwayomiSourceMerge/Infrastructure/Metadata/ComicInfoMetadataParser.cs
        purpose: Parses one ComicInfo.xml path into metadata fields used by details generation with race-tolerant read failure handling.
      - symbol: IComicInfoMetadataParser
        kind: interface
        path: SuwayomiSourceMerge/Infrastructure/Metadata/IComicInfoMetadataParser.cs
        purpose: Defines parser contract consumed by override details generation services.
      - symbol: IOverrideDetailsService
        kind: interface
        path: SuwayomiSourceMerge/Infrastructure/Metadata/IOverrideDetailsService.cs
        purpose: Defines canonical details.json ensure contract for seeding and ComicInfo fallback behavior.
      - symbol: OverrideDetailsService
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Metadata/OverrideDetailsService.cs
        purpose: Ensures details.json by checking existing overrides, seeding from sources, and generating from ComicInfo candidates.
      - symbol: OverrideDetailsService.EnsureDetailsJson
        kind: method
        path: SuwayomiSourceMerge/Infrastructure/Metadata/OverrideDetailsService.cs
        purpose: Executes deterministic ensure flow and returns typed outcome metadata for callers.
    extension_points:
      - how: Add alternate ComicInfo parsing strategies by implementing IComicInfoMetadataParser and injecting it into OverrideDetailsService.
        symbols: [ComicInfoMetadataParser, IComicInfoMetadataParser, OverrideDetailsService]
        paths: [SuwayomiSourceMerge/Infrastructure/Metadata/ComicInfoMetadataParser.cs, SuwayomiSourceMerge/Infrastructure/Metadata/IComicInfoMetadataParser.cs, SuwayomiSourceMerge/Infrastructure/Metadata/OverrideDetailsService.cs]
      - how: Adjust details.json output mapping (status code, description mode, genre splitting, field shape) in the override details service.
        symbols: [OverrideDetailsService, OverrideDetailsService.EnsureDetailsJson]
        paths: [SuwayomiSourceMerge/Infrastructure/Metadata/OverrideDetailsService.cs]
      - how: Extend result metadata semantics exposed to callers (for example existence flags) in the override result model and service return construction.
        symbols: [OverrideDetailsResult, OverrideDetailsService.EnsureDetailsJson]
        paths: [SuwayomiSourceMerge/Infrastructure/Metadata/OverrideDetailsResult.cs, SuwayomiSourceMerge/Infrastructure/Metadata/OverrideDetailsService.cs]
      - how: Wire runtime orchestration to metadata ensure behavior through IOverrideDetailsService instead of duplicating seed/generate logic.
        symbols: [IOverrideDetailsService, OverrideDetailsService]
        paths: [SuwayomiSourceMerge/Infrastructure/Metadata/IOverrideDetailsService.cs, SuwayomiSourceMerge/Infrastructure/Metadata/OverrideDetailsService.cs]
    do_not_reimplement:
      - Canonical ComicInfo strict-then-fallback parsing behavior; use ComicInfoMetadataParser.TryParse.
      - Canonical details.json ensure flow (override check, source seed, ComicInfo fallback); use OverrideDetailsService.EnsureDetailsJson.
      - Canonical metadata best-effort IO/race handling for source seeding, candidate traversal, and details writes; use OverrideDetailsService.EnsureDetailsJson.
      - Canonical details.json existence flag semantics returned to callers; use OverrideDetailsResult.DetailsJsonExists.
      - Canonical details.json request validation and description-mode normalization; use OverrideDetailsRequest.
      - Canonical runtime contract for details.json ensure operations; use IOverrideDetailsService.
    related: [runtime-host, unit-test-suite]
  - id: infrastructure-mounts
    summary: findmnt-backed mount snapshots and deterministic planner-only reconciliation for mount/remount/unmount actions.
    tags: [infrastructure, mounts, reconciliation, runtime]
    paths:
      - SuwayomiSourceMerge/Infrastructure/Mounts/DesiredMountDefinition.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/FindmntMountSnapshotService.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/FindmntSnapshotLineParser.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/IMountReconciliationService.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/IMountSnapshotService.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/MountReconciliationAction.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/MountReconciliationInput.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/MountReconciliationPlan.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/MountReconciliationReason.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/MountReconciliationService.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/MountSnapshot.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Mounts/FindmntMountSnapshotServiceTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Mounts/FindmntSnapshotLineParserTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Mounts/MountReconciliationServiceTests.cs
    entrypoints:
      - symbol: FindmntMountSnapshotService
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Mounts/FindmntMountSnapshotService.cs
        purpose: Captures mount snapshots via findmnt and emits deterministic parse/command warnings.
      - symbol: FindmntMountSnapshotService.Capture
        kind: method
        path: SuwayomiSourceMerge/Infrastructure/Mounts/FindmntMountSnapshotService.cs
        purpose: Executes findmnt with util-linux-compatible pairs-mode flags and returns parsed mount entries plus non-fatal warnings.
      - symbol: IMountReconciliationService
        kind: interface
        path: SuwayomiSourceMerge/Infrastructure/Mounts/IMountReconciliationService.cs
        purpose: Defines planner contract for deterministic mount reconciliation.
      - symbol: IMountSnapshotService
        kind: interface
        path: SuwayomiSourceMerge/Infrastructure/Mounts/IMountSnapshotService.cs
        purpose: Defines mount-state snapshot capture contract for reconciliation consumers.
      - symbol: MountReconciliationService
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Mounts/MountReconciliationService.cs
        purpose: Computes deterministic mount/remount/unmount actions using normalized mountpoint key comparisons.
      - symbol: MountReconciliationService.Reconcile
        kind: method
        path: SuwayomiSourceMerge/Infrastructure/Mounts/MountReconciliationService.cs
        purpose: Produces ordered actions with normalized desired/actual/force/stale matching and stale-mergerfs cleanup.
    extension_points:
      - how: Add additional snapshot metadata fields by extending MountSnapshotEntry and parser mapping in the findmnt snapshot service.
        symbols: [FindmntMountSnapshotService, FindmntSnapshotLineParser, MountSnapshotEntry]
        paths: [SuwayomiSourceMerge/Infrastructure/Mounts/FindmntMountSnapshotService.cs, SuwayomiSourceMerge/Infrastructure/Mounts/FindmntSnapshotLineParser.cs, SuwayomiSourceMerge/Infrastructure/Mounts/MountSnapshot.cs]
      - how: Swap snapshot capture sources (for example mountinfo readers) by implementing IMountSnapshotService and wiring the new service.
        symbols: [FindmntMountSnapshotService, IMountSnapshotService]
        paths: [SuwayomiSourceMerge/Infrastructure/Mounts/FindmntMountSnapshotService.cs, SuwayomiSourceMerge/Infrastructure/Mounts/IMountSnapshotService.cs]
      - how: Wire mount command applicators to deterministic reconciliation outputs by consuming IMountReconciliationService actions.
        symbols: [IMountReconciliationService, MountReconciliationAction, MountReconciliationService]
        paths: [SuwayomiSourceMerge/Infrastructure/Mounts/IMountReconciliationService.cs, SuwayomiSourceMerge/Infrastructure/Mounts/MountReconciliationAction.cs, SuwayomiSourceMerge/Infrastructure/Mounts/MountReconciliationService.cs]
    do_not_reimplement:
      - Canonical reconciliation action contract for planner outputs; use MountReconciliationAction.
      - Canonical desired-vs-actual reconciliation decision engine; use MountReconciliationService.Reconcile.
      - Canonical findmnt snapshot capture and parse-warning behavior (including non-throwing parser guards and escape decoding); use FindmntMountSnapshotService.
      - Canonical normalized mountpoint key matching across desired/actual/forced/stale checks; use MountReconciliationService.Reconcile.
      - Canonical snapshot model consumed by mount reconciliation flows; use MountSnapshot.
    related: [infrastructure-branch-planning, infrastructure-processes, runtime-host, unit-test-suite]
  - id: infrastructure-processes
    summary: External process execution with poll-supervised timeout/cancellation, exit-precedence boundary probes, and bounded output capture.
    tags: [infrastructure, process, runtime]
    paths:
      - SuwayomiSourceMerge/Infrastructure/Processes/BoundedOutputBuffer.cs
      - SuwayomiSourceMerge/Infrastructure/Processes/ExternalCommandExecutor.cs
      - SuwayomiSourceMerge/Infrastructure/Processes/ExternalCommandRequest.cs
      - SuwayomiSourceMerge/Infrastructure/Processes/ExternalCommandResult.cs
      - SuwayomiSourceMerge/Infrastructure/Processes/IExternalCommandExecutor.cs
      - SuwayomiSourceMerge/Infrastructure/Processes/IProcessFacade.cs
      - SuwayomiSourceMerge/Infrastructure/Processes/SystemProcessFacade.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Processes/ExternalCommandExecutorTests.cs
    entrypoints:
      - symbol: ExternalCommandExecutor
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Processes/ExternalCommandExecutor.cs
        purpose: Executes external commands with typed outcomes, timeout supervision, and bounded stdout/stderr capture.
      - symbol: ExternalCommandExecutor.Execute
        kind: method
        path: SuwayomiSourceMerge/Infrastructure/Processes/ExternalCommandExecutor.cs
        purpose: Runs one command request and returns deterministic success, timeout, cancellation, or startup-failure results.
      - symbol: ExternalCommandRequest
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Processes/ExternalCommandRequest.cs
        purpose: Defines executable name, arguments, timeout, polling interval, and output-capture limits.
      - symbol: ExternalCommandResult
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Processes/ExternalCommandResult.cs
        purpose: Carries command outcome classification, optional exit code, bounded output, truncation flags, and elapsed duration.
      - symbol: IExternalCommandExecutor
        kind: interface
        path: SuwayomiSourceMerge/Infrastructure/Processes/IExternalCommandExecutor.cs
        purpose: Defines the canonical synchronous command-execution contract for runtime orchestration services.
      - symbol: SystemProcessFacade
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Processes/SystemProcessFacade.cs
        purpose: Adapts System.Diagnostics.Process to the internal process-facade contract used by the executor.
    extension_points:
      - how: Add richer failure classification by extending startup-exception mapping in the command executor.
        symbols: [ExternalCommandExecutor, ExternalCommandFailureKind]
        paths: [SuwayomiSourceMerge/Infrastructure/Processes/ExternalCommandExecutor.cs, SuwayomiSourceMerge/Infrastructure/Processes/ExternalCommandResult.cs]
      - how: Add tool-specific wrapper services by composing typed request builders over IExternalCommandExecutor.
        symbols: [ExternalCommandRequest, IExternalCommandExecutor]
        paths: [SuwayomiSourceMerge/Infrastructure/Processes/ExternalCommandRequest.cs, SuwayomiSourceMerge/Infrastructure/Processes/IExternalCommandExecutor.cs]
      - how: Swap process behavior in tests or alternate hosts by injecting a custom process-facade factory into ExternalCommandExecutor.
        symbols: [ExternalCommandExecutor, IProcessFacade]
        paths: [SuwayomiSourceMerge/Infrastructure/Processes/ExternalCommandExecutor.cs, SuwayomiSourceMerge/Infrastructure/Processes/IProcessFacade.cs]
    do_not_reimplement:
      - Canonical bounded stdout/stderr capture with truncation flags; use ExternalCommandExecutor.
      - Canonical command outcome + failure-kind contract for process execution; use ExternalCommandResult.
      - Canonical poll-supervised timeout/cancellation process handling; use ExternalCommandExecutor.Execute.
      - Canonical timeout/cancellation boundary exit-precedence probes; use ExternalCommandExecutor.TryWaitForExit.
      - Canonical fail-open capture completion handling with trace diagnostics for unexpected non-fatal faults; use ExternalCommandExecutor.WaitForCaptureCompletion.
      - Canonical process-system adapter for real host execution; use SystemProcessFacade.
    related: [infrastructure-mounts, runtime-host, unit-test-suite]
  - id: infrastructure-volumes
    summary: Container volume discovery for source and override roots with deterministic ordering and warnings.
    tags: [filesystem, infrastructure, volumes]
    paths:
      - SuwayomiSourceMerge/Infrastructure/Volumes/ContainerVolumeDiscoveryResult.cs
      - SuwayomiSourceMerge/Infrastructure/Volumes/ContainerVolumeDiscoveryService.cs
      - SuwayomiSourceMerge/Infrastructure/Volumes/ContainerVolumeFileSystem.cs
      - SuwayomiSourceMerge/Infrastructure/Volumes/IContainerVolumeDiscoveryService.cs
      - SuwayomiSourceMerge/Infrastructure/Volumes/IContainerVolumeFileSystem.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Volumes/ContainerVolumeDiscoveryResultTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Volumes/ContainerVolumeDiscoveryServiceContractTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Volumes/ContainerVolumeDiscoveryServiceTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Volumes/ContainerVolumeFileSystemTests.cs
    entrypoints:
      - symbol: ContainerVolumeDiscoveryResult
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Volumes/ContainerVolumeDiscoveryResult.cs
        purpose: Returns discovered source/override volume paths and non-fatal discovery warnings.
      - symbol: ContainerVolumeDiscoveryService
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Volumes/ContainerVolumeDiscoveryService.cs
        purpose: Discovers direct-child source and override volumes and emits warnings for missing roots.
      - symbol: ContainerVolumeDiscoveryService.Discover
        kind: method
        path: SuwayomiSourceMerge/Infrastructure/Volumes/ContainerVolumeDiscoveryService.cs
        purpose: Validates root paths, enumerates direct-child directories, and returns sorted results.
      - symbol: ContainerVolumeFileSystem
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Volumes/ContainerVolumeFileSystem.cs
        purpose: Provides direct filesystem calls for path normalization and direct-child directory enumeration.
      - symbol: IContainerVolumeDiscoveryService
        kind: interface
        path: SuwayomiSourceMerge/Infrastructure/Volumes/IContainerVolumeDiscoveryService.cs
        purpose: Defines the canonical discovery entrypoint for mapped source and override volumes.
      - symbol: IContainerVolumeFileSystem
        kind: interface
        path: SuwayomiSourceMerge/Infrastructure/Volumes/IContainerVolumeFileSystem.cs
        purpose: Defines filesystem operations consumed by volume discovery for deterministic testing.
    extension_points:
      - how: Adapt internal discovery results to strongly typed public test contracts to keep reusable contract tests compile-time safe.
        symbols: [ContainerVolumeDiscoveryServiceContractTestsBase, IVolumeDiscoveryContractService]
        paths: [tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Volumes/ContainerVolumeDiscoveryServiceContractTests.cs]
      - how: Add additional discovery diagnostics by extending warning/result types consumed by orchestrators.
        symbols: [ContainerVolumeDiscoveryResult, ContainerVolumeDiscoveryWarning]
        paths: [SuwayomiSourceMerge/Infrastructure/Volumes/ContainerVolumeDiscoveryResult.cs]
      - how: Extend discovered root categories by adding interface methods and implementing them in the discovery service.
        symbols: [ContainerVolumeDiscoveryService, IContainerVolumeDiscoveryService]
        paths: [SuwayomiSourceMerge/Infrastructure/Volumes/ContainerVolumeDiscoveryService.cs, SuwayomiSourceMerge/Infrastructure/Volumes/IContainerVolumeDiscoveryService.cs]
      - how: Swap filesystem behavior in tests or future runtime variants by implementing the filesystem interface dependency.
        symbols: [ContainerVolumeDiscoveryService, IContainerVolumeFileSystem]
        paths: [SuwayomiSourceMerge/Infrastructure/Volumes/ContainerVolumeDiscoveryService.cs, SuwayomiSourceMerge/Infrastructure/Volumes/IContainerVolumeFileSystem.cs]
    do_not_reimplement:
      - Canonical contract-test typing adapter for volume discovery; use IVolumeDiscoveryContractService.
      - Canonical missing-root warning semantics for volume discovery; use ContainerVolumeDiscoveryService.Discover.
      - Canonical source/override direct-child enumeration and ordering; use ContainerVolumeDiscoveryService.Discover.
      - Canonical volume discovery filesystem operations contract; use IContainerVolumeFileSystem.
    related: [runtime-host, unit-test-suite]
  - id: logging-infrastructure
    summary: Structured log formatting, level filtering, and file rolling/retention for runtime diagnostics.
    tags: [diagnostics, logging, runtime]
    paths:
      - SuwayomiSourceMerge/Infrastructure/Logging/ILogSink.cs
      - SuwayomiSourceMerge/Infrastructure/Logging/ISsmLogger.cs
      - SuwayomiSourceMerge/Infrastructure/Logging/ISsmLoggerFactory.cs
      - SuwayomiSourceMerge/Infrastructure/Logging/LogEvent.cs
      - SuwayomiSourceMerge/Infrastructure/Logging/LogFilePathPolicy.cs
      - SuwayomiSourceMerge/Infrastructure/Logging/LogLevel.cs
      - SuwayomiSourceMerge/Infrastructure/Logging/LogLevelParser.cs
      - SuwayomiSourceMerge/Infrastructure/Logging/RollingFileLogger.cs
      - SuwayomiSourceMerge/Infrastructure/Logging/RollingFileSink.cs
      - SuwayomiSourceMerge/Infrastructure/Logging/SsmLoggerFactory.cs
      - SuwayomiSourceMerge/Infrastructure/Logging/StructuredTextLogFormatter.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Logging/LogEventTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Logging/LogFilePathPolicyTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Logging/LogLevelParserTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Logging/RollingFileLoggerTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Logging/RollingFileSinkTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Logging/SsmLoggerFactoryTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Logging/StructuredTextLogFormatterTests.cs
    entrypoints:
      - symbol: ISsmLogger
        kind: interface
        path: SuwayomiSourceMerge/Infrastructure/Logging/ISsmLogger.cs
        purpose: Defines canonical structured log emission methods and level checks.
      - symbol: LogFilePathPolicy
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Logging/LogFilePathPolicy.cs
        purpose: Enforces deterministic log-file-name safety rules (invalid chars, trailing dot/space, reserved Windows device names on all platforms) and root containment.
      - symbol: LogLevelParser
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Logging/LogLevelParser.cs
        purpose: Centralizes logging-level token parsing with non-throwing TryParse and shared supported-token display.
      - symbol: RollingFileLogger
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Logging/RollingFileLogger.cs
        purpose: Applies level filtering (including non-emitting LogLevel.None sentinel handling) and fail-open sink writes with stderr fallback.
      - symbol: RollingFileSink
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Logging/RollingFileSink.cs
        purpose: Persists structured lines to disk with size-based rolling and retention.
      - symbol: SsmLoggerFactory
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Logging/SsmLoggerFactory.cs
        purpose: Maps validated settings to configured logger instances and level behavior.
      - symbol: StructuredTextLogFormatter
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Logging/StructuredTextLogFormatter.cs
        purpose: Formats log events into deterministic single-line key/value text output.
    extension_points:
      - how: Add new sink targets by implementing the sink contract and wiring them via the logger factory.
        symbols: [ILogSink, SsmLoggerFactory]
        paths: [SuwayomiSourceMerge/Infrastructure/Logging/ILogSink.cs, SuwayomiSourceMerge/Infrastructure/Logging/SsmLoggerFactory.cs]
      - how: Change structured line rendering and escaping behavior in the text formatter.
        symbols: [StructuredTextLogFormatter]
        paths: [SuwayomiSourceMerge/Infrastructure/Logging/StructuredTextLogFormatter.cs]
      - how: Update level-threshold behavior and fallback write semantics in the rolling logger.
        symbols: [ISsmLogger, RollingFileLogger]
        paths: [SuwayomiSourceMerge/Infrastructure/Logging/ISsmLogger.cs, SuwayomiSourceMerge/Infrastructure/Logging/RollingFileLogger.cs]
      - how: Update retention and rollover file policies in the rolling file sink.
        symbols: [RollingFileSink]
        paths: [SuwayomiSourceMerge/Infrastructure/Logging/RollingFileSink.cs]
    do_not_reimplement:
      - Canonical config-to-logger construction; use SsmLoggerFactory.
      - Canonical log-file name/path safety checks; use LogFilePathPolicy.
      - Canonical level filtering and sink fault fallback behavior; use RollingFileLogger.
      - Canonical non-emitting handling for LogLevel.None sentinel values; use RollingFileLogger.
      - Canonical logging-level token parsing shared by validation and runtime; use LogLevelParser.
      - Canonical non-throw probing for logging-level tokens; use LogLevelParser.TryParse.
      - Canonical structured text line format and escaping policy; use StructuredTextLogFormatter.
      - Canonical size-based rollover and retained archive handling; use RollingFileSink.
    related: [application-hosting, config-schema-validation, unit-test-suite]
  - id: runtime-host
    summary: Console application host and project-level runtime configuration.
    tags: [runtime, host, console]
    paths:
      - SuwayomiSourceMerge/Program.cs
      - SuwayomiSourceMerge/SuwayomiSourceMerge.csproj
    entrypoints:
      - symbol: Program.cs
        kind: file
        path: SuwayomiSourceMerge/Program.cs
        purpose: Current runtime entrypoint for the console application.
      - symbol: ProgramEntryPoint.Run
        kind: method
        path: SuwayomiSourceMerge/Program.cs
        purpose: Executes the composed application host using the canonical container config root.
      - symbol: SuwayomiSourceMerge.csproj
        kind: file
        path: SuwayomiSourceMerge/SuwayomiSourceMerge.csproj
        purpose: Defines runtime target framework and build behavior.
    extension_points:
      - how: Add new runtime orchestration by introducing services and invoking them from Program.cs.
        symbols: [Program.cs]
        paths: [SuwayomiSourceMerge/Program.cs]
      - how: Add project-level runtime/build settings in the application project file.
        symbols: [SuwayomiSourceMerge.csproj]
        paths: [SuwayomiSourceMerge/SuwayomiSourceMerge.csproj]
    do_not_reimplement:
      - Console entrypoint bootstrapping; extend Program.cs.
      - Canonical default startup config root handoff to application host; use ProgramEntryPoint.Run.
      - Runtime project configuration root; extend SuwayomiSourceMerge.csproj.
      - Warning policy overrides in app project; keep centralized in Directory.Build.props.
    related: [application-hosting, build-and-quality, shared-test-support, unit-test-suite]
  - id: shared-test-support
    summary: Reusable testing helpers shared across test projects.
    tags: [tests, support, shared]
    paths:
      - tests/SuwayomiSourceMerge.Testing/Class1.cs
      - tests/SuwayomiSourceMerge.Testing/SuwayomiSourceMerge.Testing.csproj
    entrypoints:
      - symbol: SuwayomiSourceMerge.Testing.csproj
        kind: file
        path: tests/SuwayomiSourceMerge.Testing/SuwayomiSourceMerge.Testing.csproj
        purpose: Shared test-support project referenced by test suites.
      - symbol: TestPathHelper
        kind: class
        path: tests/SuwayomiSourceMerge.Testing/Class1.cs
        purpose: Canonical helper class for common test path operations.
      - symbol: TestPathHelper.Combine
        kind: method
        path: tests/SuwayomiSourceMerge.Testing/Class1.cs
        purpose: Combines path segments for tests using platform separators.
    extension_points:
      - how: Add reusable fixtures/utilities in the shared support project for broad test reuse.
        symbols: [TestPathHelper]
        paths: [tests/SuwayomiSourceMerge.Testing/Class1.cs]
      - how: Expand shared support dependencies via the test-support project file.
        symbols: [SuwayomiSourceMerge.Testing.csproj]
        paths: [tests/SuwayomiSourceMerge.Testing/SuwayomiSourceMerge.Testing.csproj]
    do_not_reimplement:
      - Shared path composition helper; use TestPathHelper.Combine.
      - Shared test helper project root; use SuwayomiSourceMerge.Testing.csproj.
    related: [runtime-host, unit-test-suite]
  - id: unit-test-suite
    summary: Primary xUnit project covering config, host lifecycle, and logging behavior with mutation scaffolding.
    tags: [tests, xunit, validation]
    paths:
      - tests/SuwayomiSourceMerge.UnitTests/Application/Hosting/ApplicationHostTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Bootstrap/ConfigurationBootstrapExceptionTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Bootstrap/ConfigurationBootstrapGuardTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Bootstrap/ConfigurationBootstrapServiceTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Bootstrap/ConfigurationBootstrapServiceSceneTagValidationTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Bootstrap/ConfigurationPathSetTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Bootstrap/LegacyMangaEquivalentsMigratorTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Bootstrap/LegacySourcePriorityMigratorTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Bootstrap/SettingsSelfHealingServiceTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Bootstrap/YamlDocumentWriterTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/ConfigurationSchemaServiceFactory.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/ConfigurationTestData.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Loading/ConfigurationSchemaServiceTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Loading/ConfigurationValidationPipelineTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/MangaEquivalentsSchemaTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Resolution/MangaEquivalenceServiceTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Resolution/OverrideCanonicalResolverTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Resolution/SourcePriorityServiceTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/SceneTagsSchemaTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/SettingsDocumentDefaultsTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/SettingsSchemaTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/SourcePrioritySchemaTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Validation/MangaEquivalentsDocumentValidatorTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Validation/SceneTagsDocumentValidatorTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Validation/SettingsDocumentValidatorTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Validation/SourcePriorityDocumentValidatorTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Validation/ValidationKeyNormalizerPropertyTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Validation/ValidationKeyNormalizerTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Validation/ValidationResultTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/YamlDocumentParserPropertyTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/YamlDocumentParserTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Domain/Normalization/ComparisonTextNormalizerTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Domain/Normalization/SceneTagMatcherTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Domain/Normalization/TitleKeyNormalizerTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Logging/LogEventTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Logging/LogFilePathPolicyTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Logging/LogLevelParserTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Logging/RollingFileLoggerTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Logging/RollingFileSinkTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Logging/SsmLoggerFactoryTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Logging/StructuredTextLogFormatterTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Metadata/ComicInfoMetadataParserTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Metadata/OverrideDetailsServiceTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Volumes/ContainerVolumeDiscoveryResultTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Volumes/ContainerVolumeDiscoveryServiceContractTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Volumes/ContainerVolumeDiscoveryServiceTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Volumes/ContainerVolumeFileSystemTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/ProgramEntryPointTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/README.md
      - tests/SuwayomiSourceMerge.UnitTests/stryker-config.json
      - tests/SuwayomiSourceMerge.UnitTests/SuwayomiSourceMerge.UnitTests.csproj
      - tests/SuwayomiSourceMerge.UnitTests/TestInfrastructure/PathTestUtilities.cs
      - tests/SuwayomiSourceMerge.UnitTests/TestInfrastructure/TemporaryDirectory.cs
      - tests/SuwayomiSourceMerge.UnitTests/UnitTest1.cs
    entrypoints:
      - symbol: ConfigurationBootstrapServiceTests
        kind: class
        path: tests/SuwayomiSourceMerge.UnitTests/Configuration/Bootstrap/ConfigurationBootstrapServiceTests.cs
        purpose: Verifies expected, edge, and failure behavior for bootstrap and legacy migration.
      - symbol: ConfigurationValidationPipelineTests
        kind: class
        path: tests/SuwayomiSourceMerge.UnitTests/Configuration/Loading/ConfigurationValidationPipelineTests.cs
        purpose: Verifies parse/validate orchestration, guard clauses, and validator exception propagation.
      - symbol: SettingsSchemaTests
        kind: class
        path: tests/SuwayomiSourceMerge.UnitTests/Configuration/SettingsSchemaTests.cs
        purpose: Verifies expected, edge, and failure validation behavior for settings schema.
      - symbol: stryker-config.json
        kind: file
        path: tests/SuwayomiSourceMerge.UnitTests/stryker-config.json
        purpose: Defines mutation-testing scope and threshold break values for configuration code.
      - symbol: SuwayomiSourceMerge.UnitTests.csproj
        kind: file
        path: tests/SuwayomiSourceMerge.UnitTests/SuwayomiSourceMerge.UnitTests.csproj
        purpose: Defines xUnit + FsCheck test framework dependencies and project references.
      - symbol: ValidationKeyNormalizerPropertyTests
        kind: class
        path: tests/SuwayomiSourceMerge.UnitTests/Configuration/Validation/ValidationKeyNormalizerPropertyTests.cs
        purpose: Verifies key-normalization invariants with property-based tests.
    extension_points:
      - how: Add new deterministic unit tests in the unit test project and centralize reusable fixtures/helpers for reuse.
        symbols: [ProjectLayoutTests, SuwayomiSourceMerge.UnitTests.csproj]
        paths: [tests/SuwayomiSourceMerge.UnitTests/Configuration/ConfigurationTestData.cs, tests/SuwayomiSourceMerge.UnitTests/SuwayomiSourceMerge.UnitTests.csproj, tests/SuwayomiSourceMerge.UnitTests/TestInfrastructure/PathTestUtilities.cs, tests/SuwayomiSourceMerge.UnitTests/TestInfrastructure/TemporaryDirectory.cs, tests/SuwayomiSourceMerge.UnitTests/UnitTest1.cs]
      - how: Adjust mutation-test scope and score gates in the stryker configuration file.
        symbols: [stryker-config.json]
        paths: [tests/SuwayomiSourceMerge.UnitTests/stryker-config.json]
      - how: Extend framework/test-runner dependencies in the unit test project file.
        symbols: [SuwayomiSourceMerge.UnitTests.csproj]
        paths: [tests/SuwayomiSourceMerge.UnitTests/SuwayomiSourceMerge.UnitTests.csproj]
    do_not_reimplement:
      - Baseline test-harness smoke coverage; extend ProjectLayoutTests.
      - Canonical unit-test project wiring; use SuwayomiSourceMerge.UnitTests.csproj.
      - Canonical YAML schema validation test scenarios; extend configuration schema test classes.
      - Host lifecycle and stderr fallback coverage; extend ApplicationHostTests.
      - Logging formatter/filter/rolling behavior coverage; extend Infrastructure/Logging test classes.
      - Mutation-test scope and threshold gates; use stryker-config.json.
    related: [application-hosting, build-and-quality, config-schema-validation, logging-infrastructure, runtime-host, shared-test-support]

version: 1
language: csharp
unity:
  asmdef_paths: []
maintenance:
  update_when:
    - Add, remove, or rename entrypoint files/classes/methods in runtime or test projects.
    - Change build/test wiring, project references, or central MSBuild policies.
    - Introduce new canonical extension points to avoid duplicate implementations.
  generation_notes:
    - Verify symbols directly in source files before adding or modifying entries.
    - Keep modules curated around canonical runtime, build, and test roots.
    - When configuration APIs are edited, keep XMLDOC coverage complete across touched identifiers.
conventions:
  - Treat warnings as errors globally via central MSBuild props.
  - Use PascalCase for const fields and `_camelCase` for private static readonly fields.
  - Use xUnit for unit tests and keep reusable fixtures/helpers in a shared test project.
  - Prefer extending existing orchestration/test roots over creating parallel frameworks.
  - Keep XMLDOC comments detailed for runtime and configuration APIs so intent/usage are clear in-code.
modules:
  - id: application-hosting
    summary: Runtime host orchestration that bootstraps configuration, initializes logging, and runs daemon supervision.
    tags: [application, hosting, runtime]
    paths:
      - SuwayomiSourceMerge/Application/Hosting/ApplicationHost.cs
      - SuwayomiSourceMerge/Application/Hosting/DefaultRuntimeSupervisorRunner.cs
      - SuwayomiSourceMerge/Application/Hosting/IRuntimeSupervisorRunner.cs
      - SuwayomiSourceMerge/Application/Hosting/SceneTagConfigurationAdvisor.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Hosting/ApplicationHostTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Hosting/SceneTagConfigurationAdvisorTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/ProgramEntryPointTests.cs
    entrypoints:
      - symbol: ApplicationHost
        kind: class
        path: SuwayomiSourceMerge/Application/Hosting/ApplicationHost.cs
        purpose: Coordinates bootstrap, logger creation, runtime supervision invocation, and failure handling.
      - symbol: ApplicationHost.CreateDefault
        kind: method
        path: SuwayomiSourceMerge/Application/Hosting/ApplicationHost.cs
        purpose: Builds the default production composition of bootstrap, logging, and runtime supervisor services.
      - symbol: ApplicationHost.Run
        kind: method
        path: SuwayomiSourceMerge/Application/Hosting/ApplicationHost.cs
        purpose: Executes host startup/runtime/shutdown flow, emits distinct success/failure shutdown lifecycle events, and writes stderr fallback diagnostics on failures.
      - symbol: ApplicationHostTests
        kind: class
        path: tests/SuwayomiSourceMerge.UnitTests/Application/Hosting/ApplicationHostTests.cs
        purpose: Verifies bootstrap/runtime success paths, runner invocation, and fatal-path handling.
      - symbol: DefaultRuntimeSupervisorRunner
        kind: class
        path: SuwayomiSourceMerge/Application/Hosting/DefaultRuntimeSupervisorRunner.cs
        purpose: Composes watcher, rename, mount workflow, and supervisor dependencies for production runtime flow.
      - symbol: IRuntimeSupervisorRunner
        kind: interface
        path: SuwayomiSourceMerge/Application/Hosting/IRuntimeSupervisorRunner.cs
        purpose: Defines the runtime supervision execution contract consumed by the application host.
    extension_points:
      - how: Add alternate runtime supervision implementations by injecting custom runner implementations.
        symbols: [ApplicationHost, IRuntimeSupervisorRunner]
        paths: [SuwayomiSourceMerge/Application/Hosting/ApplicationHost.cs, SuwayomiSourceMerge/Application/Hosting/IRuntimeSupervisorRunner.cs]
      - how: Add or adjust host lifecycle events and shutdown behavior in the run pipeline.
        symbols: [ApplicationHost.Run]
        paths: [SuwayomiSourceMerge/Application/Hosting/ApplicationHost.cs]
      - how: Swap runtime composition dependencies by extending the default host factory method.
        symbols: [ApplicationHost.CreateDefault]
        paths: [SuwayomiSourceMerge/Application/Hosting/ApplicationHost.cs]
    do_not_reimplement:
      - Canonical host lifecycle orchestration and stderr fallback handling; use ApplicationHost.Run.
      - Canonical host startup/bootstrap/shutdown status-event emission at normal severity; use ApplicationHost.Run.
      - Canonical recommended scene-tag drift diagnostics for warn-only runtime visibility; use SceneTagConfigurationAdvisor.GetMissingRecommendedTags and DefaultRuntimeSupervisorRunner.Run.
      - Canonical runtime failure lifecycle event emission (`host.shutdown_failed`) when runtime exits non-zero; use ApplicationHost.Run.
      - Canonical runtime dependency composition for bootstrap, logging, and supervision; use ApplicationHost.CreateDefault.
      - Canonical runtime supervisor dependency composition for production startup; use DefaultRuntimeSupervisorRunner.
      - Canonical unhandled-host exception diagnostics with full exception payload (`exception.ToString()` stack trace); use ApplicationHost.TryLogUnhandledException.
    related: [application-mounting, application-supervision, logging-infrastructure, runtime-host, unit-test-suite]
  - id: application-mounting
    summary: Production merge workflow orchestration and lifecycle cleanup for branch planning, reconciliation, mount apply, and mount-readiness fail-fast handling.
    tags: [application, mounting, runtime]
    paths:
      - SuwayomiSourceMerge/Application/Mounting/IMergeMountWorkflow.cs
      - SuwayomiSourceMerge/Application/Mounting/IMergeRuntimeLifecycle.cs
      - SuwayomiSourceMerge/Application/Mounting/MergeMountWorkflow.Cleanup.cs
      - SuwayomiSourceMerge/Application/Mounting/MergeMountWorkflow.Cleanup.MergedRoot.cs
      - SuwayomiSourceMerge/Application/Mounting/MergeMountWorkflow.Groups.cs
      - SuwayomiSourceMerge/Application/Mounting/MergeMountWorkflow.Pass.Apply.cs
      - SuwayomiSourceMerge/Application/Mounting/MergeMountWorkflow.Pass.cs
      - SuwayomiSourceMerge/Application/Mounting/MergeMountWorkflow.Pass.ForceRemount.cs
      - SuwayomiSourceMerge/Application/Mounting/MergeMountWorkflow.Pass.Grouping.cs
      - SuwayomiSourceMerge/Application/Mounting/MergeMountWorkflow.cs
      - SuwayomiSourceMerge/Application/Mounting/MergeMountWorkflowOptions.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Mounting/MergeMountWorkflowTests.CleanupMergedRoot.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Mounting/MergeMountWorkflowTests.DegradedVisibilityAndOverrideTitles.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Mounting/MergeMountWorkflowTests.FailFastMountFailures.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Mounting/MergeMountWorkflowTests.Fakes.MountCommands.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Mounting/MergeMountWorkflowTests.Fakes.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Mounting/MergeMountWorkflowTests.OutcomesAndCancellation.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Mounting/MergeMountWorkflowTests.WarningDiagnostics.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Mounting/MergeMountWorkflowTests.cs
    entrypoints:
      - symbol: IMergeMountWorkflow
        kind: interface
        path: SuwayomiSourceMerge/Application/Mounting/IMergeMountWorkflow.cs
        purpose: Defines production merge dispatch contract for full scan/plan/reconcile/apply passes.
      - symbol: IMergeRuntimeLifecycle
        kind: interface
        path: SuwayomiSourceMerge/Application/Mounting/IMergeRuntimeLifecycle.cs
        purpose: Defines startup and shutdown lifecycle hooks consumed by daemon workers.
      - symbol: MergeMountWorkflow
        kind: class
        path: SuwayomiSourceMerge/Application/Mounting/MergeMountWorkflow.cs
        purpose: Runs merge passes, maps apply outcomes, and owns startup/shutdown cleanup behavior.
      - symbol: MergeMountWorkflow.OnWorkerStarting
        kind: method
        path: SuwayomiSourceMerge/Application/Mounting/MergeMountWorkflow.cs
        purpose: Executes managed-root startup cleanup when runtime.startup_cleanup is enabled.
      - symbol: MergeMountWorkflow.OnWorkerStopping
        kind: method
        path: SuwayomiSourceMerge/Application/Mounting/MergeMountWorkflow.cs
        purpose: Executes managed-root shutdown unmount cleanup when shutdown.unmount_on_exit is enabled.
      - symbol: MergeMountWorkflow.RunMergePass
        kind: method
        path: SuwayomiSourceMerge/Application/Mounting/MergeMountWorkflow.Pass.cs
        purpose: Performs discovery, grouping, branch planning, reconciliation, and command application for one dispatch.
    extension_points:
      - how: Add alternate runtime lifecycle cleanup behavior by implementing IMergeRuntimeLifecycle and wiring it into daemon workers.
        symbols: [IMergeRuntimeLifecycle, MergeMountWorkflow]
        paths: [SuwayomiSourceMerge/Application/Mounting/IMergeRuntimeLifecycle.cs, SuwayomiSourceMerge/Application/Mounting/MergeMountWorkflow.cs]
      - how: Swap merge dispatch orchestration by implementing IMergeMountWorkflow and replacing workflow construction in runtime hosting.
        symbols: [IMergeMountWorkflow, MergeMountWorkflow]
        paths: [SuwayomiSourceMerge/Application/Mounting/IMergeMountWorkflow.cs, SuwayomiSourceMerge/Application/Mounting/MergeMountWorkflow.cs]
      - how: Tune settings-to-workflow option mapping (including cleanup wrapper ionice/nice values) by extending MergeMountWorkflowOptions.FromSettings.
        symbols: [MergeMountWorkflowOptions, MergeMountWorkflowOptions.FromSettings]
        paths: [SuwayomiSourceMerge/Application/Mounting/MergeMountWorkflowOptions.cs]
    do_not_reimplement:
      - Canonical cancellation propagation during merge-pass branch planning and override-title discovery enumeration; use MergeMountWorkflow.RunMergePass and MergeMountWorkflow.Pass.Grouping helpers.
      - Canonical cleanup stale-prune safety gate that infers still-mounted branch directories from mergerfs source payloads and skips pruning only for degraded-visibility or unresolved mappings; use MergeMountWorkflow.RunCleanupPass.
      - Canonical merged-root residual cleanup should delete empty merged directories and quarantine non-empty residual directories under config only when mount visibility is healthy and managed mounts are inactive; use MergeMountWorkflow.CleanupMergedRootDirectories.
      - Canonical merge-pass degraded-visibility safety gate that suppresses stale-unmount apply actions when source discovery/build/snapshot visibility is degraded while still allowing mount/remount actions; use MergeMountWorkflow.RunMergePass.
      - Canonical merge-pass helper partitioning for action apply, force-remount resolution, and grouping helpers; use MergeMountWorkflow partial pass files.
      - Canonical merge-pass outcome mapping from action results (mixed when busy+failure, then busy over failure over success); use MergeMountWorkflow.RunMergePass.
      - Canonical merge-pass override-title catalog discovery/filtering before resolver construction; use MergeMountWorkflow.DiscoverExistingOverrideTitleCatalog and MergeMountWorkflow.TryCreateOverrideTitleCatalogEntry.
      - Canonical merge-workflow lifecycle status-event emission (`merge.workflow.started`, `merge.workflow.completed`, cleanup pass summary) at normal severity; use MergeMountWorkflow.RunMergePass and MergeMountWorkflow.RunCleanupPass.
      - Canonical mount-readiness flow should run per-action timeout-bounded probes then validate successful mounts against one post-apply snapshot capture; use MergeMountWorkflow.ValidateMountReadinessProbe, MergeMountWorkflow.ValidatePostApplyMountSnapshot, and IMergerfsMountCommandService.ProbeMountPointReadiness.
      - Canonical resolve-only force-remount reason resolution (`override-force:<title>`) targeting known desired mountpoints; use MergeMountWorkflow.RunMergePass.
      - Canonical source-derived fallback canonical-title display naming that strips trailing scene-tag suffixes while preserving override/equivalence precedence; use MergeMountWorkflow.ResolveCanonicalTitle.
      - Canonical startup/shutdown managed-root cleanup orchestration; use MergeMountWorkflow.OnWorkerStarting and MergeMountWorkflow.OnWorkerStopping.
      - Canonical tagged-only override preservation advisories with manual rename guidance; use MergeMountWorkflow.LogOverrideCanonicalAdvisories.
      - Canonical title grouping and canonical-title precedence flow used by merge runtime; use MergeMountWorkflow.RunMergePass.
      - Canonical warning-level merge diagnostics for no-source discovery and zero-desired-mount passes; use MergeMountWorkflow.RunMergePass.
    related: [application-hosting, application-supervision, application-watching, config-resolution, infrastructure-metadata, infrastructure-mounts, infrastructure-volumes, unit-test-suite]
  - id: application-supervision
    summary: Daemon lifecycle supervision with state-file locking, PID tracking, and signal-driven graceful shutdown.
    tags: [application, lifecycle, runtime, supervision]
    paths:
      - SuwayomiSourceMerge/Application/Cancellation/CancellationClassification.cs
      - SuwayomiSourceMerge/Application/Supervision/ConsoleSupervisorSignalRegistrar.cs
      - SuwayomiSourceMerge/Application/Supervision/DaemonSupervisor.cs
      - SuwayomiSourceMerge/Application/Supervision/DaemonSupervisorOptions.cs
      - SuwayomiSourceMerge/Application/Supervision/FilesystemEventDaemonWorker.cs
      - SuwayomiSourceMerge/Application/Supervision/IDaemonSupervisor.cs
      - SuwayomiSourceMerge/Application/Supervision/IDaemonWorker.cs
      - SuwayomiSourceMerge/Application/Supervision/ISupervisorSignalRegistrar.cs
      - SuwayomiSourceMerge/Application/Supervision/SupervisorFileLock.cs
      - SuwayomiSourceMerge/Application/Supervision/SupervisorStatePaths.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Supervision/DaemonSupervisorOptionsTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Supervision/ConsoleSupervisorSignalRegistrarTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Supervision/DaemonSupervisorTests.StackTraceLogging.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Supervision/DaemonSupervisorTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Supervision/FilesystemEventDaemonWorkerTests.cs
    entrypoints:
      - symbol: CancellationClassification.IsCooperative
        kind: method
        path: SuwayomiSourceMerge/Application/Cancellation/CancellationClassification.cs
        purpose: Classifies OperationCanceledException instances as cooperative only when they carry the caller-owned canceled token.
      - symbol: ConsoleSupervisorSignalRegistrar
        kind: class
        path: SuwayomiSourceMerge/Application/Supervision/ConsoleSupervisorSignalRegistrar.cs
        purpose: Registers console and process-exit callbacks that request daemon stop.
      - symbol: DaemonSupervisor
        kind: class
        path: SuwayomiSourceMerge/Application/Supervision/DaemonSupervisor.cs
        purpose: Coordinates single-instance start, coalesced concurrent startup, worker lifetime, startup-failure diagnostics, graceful stop, timeout-triggered process hard-stop, and state cleanup.
      - symbol: DaemonSupervisor.RunAsync
        kind: method
        path: SuwayomiSourceMerge/Application/Supervision/DaemonSupervisor.cs
        purpose: Runs the worker until stop signals or failures using stable run-state capture before callback registration and maps startup cancellation/failure to deterministic exit codes.
      - symbol: DaemonSupervisor.ShouldTreatStopAsTimedOut
        kind: method
        path: SuwayomiSourceMerge/Application/Supervision/DaemonSupervisor.cs
        purpose: Classifies stop-timeout races so timeout handling runs only when the worker remains incomplete after Task.WhenAny returns.
      - symbol: DaemonSupervisorOptions
        kind: class
        path: SuwayomiSourceMerge/Application/Supervision/DaemonSupervisorOptions.cs
        purpose: Maps validated settings to supervisor timeout and state-path configuration.
      - symbol: FilesystemEventDaemonWorker
        kind: class
        path: SuwayomiSourceMerge/Application/Supervision/FilesystemEventDaemonWorker.cs
        purpose: Executes worker startup lifecycle hooks, continuous trigger ticks, and shutdown lifecycle hooks.
      - symbol: SupervisorFileLock
        kind: class
        path: SuwayomiSourceMerge/Application/Supervision/SupervisorFileLock.cs
        purpose: Holds exclusive lock ownership over the supervisor state lock file.
    extension_points:
      - how: Add alternate signal providers by implementing signal registrar adapters used by the supervisor.
        symbols: [ConsoleSupervisorSignalRegistrar, ISupervisorSignalRegistrar]
        paths: [SuwayomiSourceMerge/Application/Supervision/ConsoleSupervisorSignalRegistrar.cs, SuwayomiSourceMerge/Application/Supervision/ISupervisorSignalRegistrar.cs]
      - how: Swap or compose daemon worker loops by implementing IDaemonWorker and wiring it into DaemonSupervisor.
        symbols: [DaemonSupervisor, FilesystemEventDaemonWorker, IDaemonWorker]
        paths: [SuwayomiSourceMerge/Application/Supervision/DaemonSupervisor.cs, SuwayomiSourceMerge/Application/Supervision/FilesystemEventDaemonWorker.cs, SuwayomiSourceMerge/Application/Supervision/IDaemonWorker.cs]
      - how: Tune state-path and stop-timeout policy by extending DaemonSupervisorOptions and SupervisorStatePaths mapping logic.
        symbols: [DaemonSupervisorOptions, SupervisorStatePaths]
        paths: [SuwayomiSourceMerge/Application/Supervision/DaemonSupervisorOptions.cs, SuwayomiSourceMerge/Application/Supervision/SupervisorStatePaths.cs]
    do_not_reimplement:
      - Canonical bounded shutdown lifecycle token flow (fresh stop token canceled at stop-timeout boundary); use DaemonSupervisor.StopCoreAsync and IDaemonWorker.RunAsync.
      - Canonical cooperative-cancellation classification shared across worker/dispatch paths (caller-token canceled + matching token OR tokenless cancellation); use CancellationClassification.IsCooperative.
      - Canonical daemon lifecycle start/stop idempotency, timeout handling, and cleanup flow; use DaemonSupervisor.
      - Canonical early-stop race handling by capturing worker/stop tasks before signal and cancellation registration; use DaemonSupervisor.RunAsync.
      - Canonical startup exception exit-code mapping (cancellation=success, non-cancellation startup failure=error) and startup-failure diagnostics; use DaemonSupervisor.RunAsync.
      - Canonical stop-timeout hard-stop behavior with boundary completion recheck before process termination; use DaemonSupervisor.StopCoreAsync and DaemonSupervisor.ShouldTreatStopAsTimedOut.
      - Canonical supervisor and worker lifecycle status-event emission (`supervisor.started`, `supervisor.stop_requested`, `supervisor.stopped`, `supervisor.worker.started`, `supervisor.worker.stopped`) at normal severity; use DaemonSupervisor and FilesystemEventDaemonWorker.
      - Canonical container SIGTERM cooperative-stop interception that prevents immediate process termination while cleanup runs; use ConsoleSupervisorSignalRegistrar POSIX signal registration.
      - Canonical state-file path resolution for supervisor lock/pid files; use SupervisorStatePaths.
      - Canonical worker lifecycle hook ordering (startup before loop, shutdown in finally with cooperative-cancellation status logs at normal severity and non-cooperative warning logging); use FilesystemEventDaemonWorker.
      - Canonical worker-loop execution model should use a dedicated long-running task (not thread-pool `Task.Run`) to avoid startup stalls under thread-pool pressure; use FilesystemEventDaemonWorker.RunAsync.
      - Canonical worker/startup fault diagnostics with full exception payload (`exception.ToString()` stack trace); use DaemonSupervisor.RunAsync.
      - Canonical worker-loop contract used by daemon supervision; use IDaemonWorker.
      - Canonical exclusive supervisor lock-file acquisition and release semantics; use SupervisorFileLock.
    related: [application-hosting, application-mounting, application-watching, unit-test-suite]
  - id: application-watching
    summary: Tick-based event trigger orchestration that routes inotify events and coalesces merge scan requests.
    tags: [application, orchestration, runtime, watching]
    paths:
      - SuwayomiSourceMerge/Application/Cancellation/CancellationClassification.cs
      - SuwayomiSourceMerge/Application/Watching/FilesystemEventTickResult.cs
      - SuwayomiSourceMerge/Application/Watching/FilesystemEventTriggerOptions.cs
      - SuwayomiSourceMerge/Application/Watching/FilesystemEventTriggerPipeline.Helpers.cs
      - SuwayomiSourceMerge/Application/Watching/FilesystemEventTriggerPipeline.cs
      - SuwayomiSourceMerge/Application/Watching/IMergeScanRequestCoalescer.cs
      - SuwayomiSourceMerge/Application/Watching/IMergeScanRequestHandler.cs
      - SuwayomiSourceMerge/Application/Watching/MergeScanDispatchOutcome.cs
      - SuwayomiSourceMerge/Application/Watching/MergeScanRequestCoalescer.cs
      - SuwayomiSourceMerge/Application/Watching/NoOpMergeScanRequestHandler.cs
      - SuwayomiSourceMerge/Application/Watching/ProductionMergeScanRequestHandler.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Watching/FilesystemEventTriggerOptionsTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Watching/FilesystemEventTriggerPipelineIntegrationTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Watching/FilesystemEventTriggerPipelineTests.Fakes.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Watching/FilesystemEventTriggerPipelineTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Watching/MergeScanRequestCoalescerTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Watching/NoOpMergeScanRequestHandlerTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Watching/ProductionMergeScanRequestHandlerTests.cs
    entrypoints:
      - symbol: FilesystemEventTriggerOptions
        kind: class
        path: SuwayomiSourceMerge/Application/Watching/FilesystemEventTriggerOptions.cs
        purpose: Stores validated watcher, rename, merge trigger, and inotify request-timeout-buffer settings mapped from settings.
      - symbol: FilesystemEventTriggerPipeline
        kind: class
        path: SuwayomiSourceMerge/Application/Watching/FilesystemEventTriggerPipeline.cs
        purpose: Runs one tick that polls inotify events, routes rename/merge triggers, executes periodic fallbacks, and dispatches coalesced requests.
      - symbol: FilesystemEventTriggerPipeline.Tick
        kind: method
        path: SuwayomiSourceMerge/Application/Watching/FilesystemEventTriggerPipeline.cs
        purpose: Executes one full watcher pass and returns deterministic tick summary metrics.
      - symbol: IMergeScanRequestCoalescer
        kind: interface
        path: SuwayomiSourceMerge/Application/Watching/IMergeScanRequestCoalescer.cs
        purpose: Defines canonical pending-request coalescing and gated dispatch behavior for merge scans.
      - symbol: MergeScanRequestCoalescer
        kind: class
        path: SuwayomiSourceMerge/Application/Watching/MergeScanRequestCoalescer.cs
        purpose: Coalesces burst merge scan requests and enforces min-interval and retry-delay gates.
      - symbol: ProductionMergeScanRequestHandler
        kind: class
        path: SuwayomiSourceMerge/Application/Watching/ProductionMergeScanRequestHandler.cs
        purpose: Delegates merge dispatch requests with severity-aligned stable dispatch event IDs for busy, mixed, and failure outcomes.
    extension_points:
      - how: Add alternate merge dispatch targets by implementing IMergeScanRequestHandler and injecting into coalescer construction.
        symbols: [IMergeScanRequestHandler, MergeScanRequestCoalescer]
        paths: [SuwayomiSourceMerge/Application/Watching/IMergeScanRequestHandler.cs, SuwayomiSourceMerge/Application/Watching/MergeScanRequestCoalescer.cs]
      - how: Adjust source/override event routing semantics by editing trigger pipeline handlers and reason mapping.
        symbols: [FilesystemEventTriggerPipeline, FilesystemEventTriggerPipeline.Tick]
        paths: [SuwayomiSourceMerge/Application/Watching/FilesystemEventTriggerPipeline.cs]
      - how: Keep production merge dispatch behavior centralized by routing coalescer dispatch through one IMergeScanRequestHandler implementation.
        symbols: [IMergeScanRequestHandler, ProductionMergeScanRequestHandler]
        paths: [SuwayomiSourceMerge/Application/Watching/IMergeScanRequestHandler.cs, SuwayomiSourceMerge/Application/Watching/ProductionMergeScanRequestHandler.cs]
      - how: Tune watcher cadence and startup-rescan behavior via options construction from settings.
        symbols: [FilesystemEventTriggerOptions, FilesystemEventTriggerOptions.FromSettings]
        paths: [SuwayomiSourceMerge/Application/Watching/FilesystemEventTriggerOptions.cs]
      - how: Wire long-running daemon loops to one-tick pipeline execution instead of duplicating event-routing and periodic fallback logic.
        symbols: [FilesystemEventTriggerPipeline, FilesystemEventTriggerPipeline.Tick]
        paths: [SuwayomiSourceMerge/Application/Watching/FilesystemEventTriggerPipeline.cs]
    do_not_reimplement:
      - Canonical burst merge-request coalescing with latest-reason and latest-force replacement semantics; use MergeScanRequestCoalescer.
      - Canonical handler/coalescer token-aware mapping for cancellation exceptions (cooperative cancellation rethrow when caller token is canceled and exception token matches or is tokenless, non-cooperative cancellation mapped to failure with failed-event emission); use ProductionMergeScanRequestHandler.DispatchMergeScan, MergeScanRequestCoalescer.DispatchPending, and CancellationClassification.IsCooperative.
      - Canonical inotify request-timeout-buffer fallback (`300`) when deprecated scan timeout buffer setting is omitted; use FilesystemEventTriggerOptions.FromSettings.
      - Canonical merge-request interval/retry gate decisions including mixed retry behavior; use MergeScanRequestCoalescer.DispatchPending.
      - Canonical normalization of unexpected handler dispatch outcomes to failure with failed-event emission; use ProductionMergeScanRequestHandler.DispatchMergeScan.
      - Canonical one-pass filesystem event routing plus periodic rename/merge fallback scheduling; use FilesystemEventTriggerPipeline.Tick.
      - Canonical production dispatch lifecycle status-event emission (`merge.dispatch.started`, `merge.dispatch.completed`) at normal severity; use ProductionMergeScanRequestHandler.DispatchMergeScan.
      - Canonical production merge dispatch event/log contract with severity-aligned busy/mixed/failure IDs and workflow delegation; use ProductionMergeScanRequestHandler.
      - Canonical startup-first merge dispatch and first-tick startup-evaluation semantics that skip duplicate startup requests when one is already pending; use FilesystemEventTriggerPipeline.Tick.
      - Canonical watcher settings mapping from validated settings documents; use FilesystemEventTriggerOptions.FromSettings.
    related: [application-mounting, application-supervision, infrastructure-rename, infrastructure-watching, runtime-host, unit-test-suite]
  - id: build-and-quality
    summary: Central build defaults and formatting behavior for the solution.
    tags: [build, msbuild, quality]
    paths:
      - .editorconfig
      - .gitattributes
      - Directory.Build.props
      - SuwayomiSourceMerge/AssemblyInfo.cs
      - SuwayomiSourceMerge/SuwayomiSourceMerge.csproj
    entrypoints:
      - symbol: .editorconfig
        kind: file
        path: .editorconfig
        purpose: Defines canonical repository code style and naming conventions.
      - symbol: .gitattributes
        kind: file
        path: .gitattributes
        purpose: Defines canonical repository text normalization and LF line-ending policy.
      - symbol: CleanupFormatLock
        kind: method
        path: SuwayomiSourceMerge/SuwayomiSourceMerge.csproj
        purpose: Removes the formatting lock file after build completion.
      - symbol: Directory.Build.props
        kind: file
        path: Directory.Build.props
        purpose: Defines solution-wide warning policy.
      - symbol: FormatCode
        kind: method
        path: SuwayomiSourceMerge/SuwayomiSourceMerge.csproj
        purpose: Runs dotnet format before compilation when enabled.
      - symbol: SuwayomiSourceMerge/AssemblyInfo.cs
        kind: file
        path: SuwayomiSourceMerge/AssemblyInfo.cs
        purpose: Declares assembly-level test visibility for internal runtime types.
    extension_points:
      - how: Add or adjust global build quality policies in the shared props file.
        symbols: [Directory.Build.props]
        paths: [Directory.Build.props]
      - how: Adjust C# formatting and naming conventions in the repository editorconfig.
        symbols: [.editorconfig]
        paths: [.editorconfig]
      - how: Adjust internal test visibility through assembly attributes instead of exposing runtime internals publicly.
        symbols: [SuwayomiSourceMerge/AssemblyInfo.cs]
        paths: [SuwayomiSourceMerge/AssemblyInfo.cs]
      - how: Adjust formatting behavior by editing build targets and conditions in the app project file.
        symbols: [CleanupFormatLock, FormatCode]
        paths: [SuwayomiSourceMerge/SuwayomiSourceMerge.csproj]
    do_not_reimplement:
      - Code formatting and naming conventions; use .editorconfig.
      - Global warnings-as-errors behavior; use Directory.Build.props.
      - Post-build formatting lock cleanup; use CleanupFormatLock.
      - Pre-build formatting orchestration; use FormatCode.
      - Repository LF line-ending normalization policy; use .gitattributes.
      - Test assembly internal visibility policy; use SuwayomiSourceMerge/AssemblyInfo.cs.
    related: [runtime-host, unit-test-suite]
  - id: container-runtime-assets
    summary: Container image, entrypoint identity/fuse policy, package integrity verification, and docker-context filtering for runtime deployment.
    tags: [container, docker, runtime]
    paths:
      - .dockerignore
      - .github/workflows/docker-publish.yml
      - Dockerfile
      - docker/entrypoint.sh
      - tests/SuwayomiSourceMerge.IntegrationTests/README.md
    entrypoints:
      - symbol: .dockerignore
        kind: file
        path: .dockerignore
        purpose: Defines canonical Docker build-context exclusions for deterministic and fast container builds.
      - symbol: .github/workflows/docker-publish.yml
        kind: file
        path: .github/workflows/docker-publish.yml
        purpose: Defines canonical GitHub Actions workflow that builds/publishes to GHCR for all branches with clear branch-prefixed tags.
      - symbol: Dockerfile
        kind: file
        path: Dockerfile
        purpose: Defines canonical multi-stage .NET build/runtime image, pinned upstream mergerfs Bookworm package install with SHA256 integrity verification, required runtime packages, and baked `cap_sys_admin` file capabilities for mergerfs/fusermount3.
      - symbol: docker/entrypoint.sh
        kind: file
        path: docker/entrypoint.sh
        purpose: Applies PUID/PGID identity mapping, uses consistent bash `[[ ... ]]` tests, parses settings scalars with YAML-aware inline-comment handling (including embedded `#` plain scalars) and escaped-backslash-aware quote handling for log mirroring, enforces runtime-parity logging.file_name safety checks (rooted/segmented, invalid/control chars, trailing dots/spaces, reserved device names) with fallback warnings, uses top-level fuse write-failure diagnostics helper flow, performs non-root FUSE device access preflight under the runtime identity, avoids recursive merged-root chown, performs best-effort first-level merged-child ownership repair with stale-endpoint-safe warnings, and launches the daemon.
      - symbol: tests/SuwayomiSourceMerge.IntegrationTests/README.md
        kind: file
        path: tests/SuwayomiSourceMerge.IntegrationTests/README.md
        purpose: Documents container E2E test execution profile and Docker daemon prerequisites.
    extension_points:
      - how: Adapt runtime package set and image-stage composition by editing Dockerfile stages and apt package list.
        symbols: [Dockerfile]
        paths: [Dockerfile]
      - how: Change startup identity defaults and ownership behavior by extending the container entrypoint script.
        symbols: [docker/entrypoint.sh]
        paths: [docker/entrypoint.sh]
      - how: Publish container images to GHCR for branch testing by tuning workflow triggers, branch tag prefixes, metadata tags, and buildx settings.
        symbols: [.github/workflows/docker-publish.yml]
        paths: [.github/workflows/docker-publish.yml]
      - how: Tune build-context transfer performance by adjusting ignored files in .dockerignore.
        symbols: [.dockerignore]
        paths: [.dockerignore]
    do_not_reimplement:
      - Canonical container build context exclusion policy; use .dockerignore.
      - Canonical container entrypoint bash test/readability policy (`[[ ... ]]` conditionals and inline fuse write stderr capture); use docker/entrypoint.sh.
      - Canonical container runtime package and multi-stage image definition; use Dockerfile.
      - Canonical container runtime package and multi-stage image definition must remove build-only curl after mergerfs package install; use Dockerfile.
      - Canonical pinned mergerfs package integrity verification (arch-specific SHA256 checks) during image builds; use Dockerfile.
      - Canonical container runtime file-capability baking for non-root mergerfs/fusermount3 command execution; use Dockerfile.
      - Canonical container startup fuse policy: skip fuse.conf edits when PUID=0 and fail non-root startup with remediation guidance when /etc/fuse.conf cannot be updated; use docker/entrypoint.sh.
      - Canonical container startup non-root FUSE device access preflight under runtime identity (skip in mock-tool mode, warning when device is absent, fail-fast when present but inaccessible); use docker/entrypoint.sh.
      - Canonical container startup fuse write-failure diagnostics with root-cause details and manual `sh -c` remediation guidance; use docker/entrypoint.sh.
      - Canonical container startup log mirroring that parses settings scalars with YAML-aware inline-comment handling (embedded plain-scalar `#` values are preserved) plus escaped-backslash-aware quote handling, then writes entrypoint diagnostics into runtime log file path derived from settings/defaults; use docker/entrypoint.sh.
      - Canonical container startup logging.file_name safety gate that rejects rooted/segmented values, trailing dots/spaces, invalid/control characters, and reserved Windows device names, then falls back to default daemon.log with warning diagnostics; use docker/entrypoint.sh.
      - Canonical container startup ownership policy that avoids recursive chown under /ssm/merged and applies best-effort first-level child ownership repair (warning-only on stale endpoint failures); use docker/entrypoint.sh.
      - Canonical container startup PUID/PGID identity mapping and daemon launch; use docker/entrypoint.sh.
      - Canonical GHCR image build/publish GitHub Actions pipeline; use .github/workflows/docker-publish.yml.
    related: [integration-test-suite, runtime-host, unit-test-suite]
  - id: config-bootstrap-migration
    summary: Bootstrap orchestration that creates missing YAML, migrates legacy text, and self-heals settings values.
    tags: [bootstrap, config, migration, yaml]
    paths:
      - SuwayomiSourceMerge/Configuration/Bootstrap/ConfigurationBootstrapException.cs
      - SuwayomiSourceMerge/Configuration/Bootstrap/ConfigurationBootstrapFileState.cs
      - SuwayomiSourceMerge/Configuration/Bootstrap/ConfigurationBootstrapResult.cs
      - SuwayomiSourceMerge/Configuration/Bootstrap/ConfigurationBootstrapService.cs
      - SuwayomiSourceMerge/Configuration/Bootstrap/ConfigurationBootstrapWarning.cs
      - SuwayomiSourceMerge/Configuration/Bootstrap/ConfigurationDocumentSet.cs
      - SuwayomiSourceMerge/Configuration/Bootstrap/ConfigurationPathSet.cs
      - SuwayomiSourceMerge/Configuration/Bootstrap/IConfigurationBootstrapService.cs
      - SuwayomiSourceMerge/Configuration/Bootstrap/LegacyMangaEquivalentsMigrator.cs
      - SuwayomiSourceMerge/Configuration/Bootstrap/LegacyMigrationResult.cs
      - SuwayomiSourceMerge/Configuration/Bootstrap/LegacySourcePriorityMigrator.cs
      - SuwayomiSourceMerge/Configuration/Bootstrap/SettingsSelfHealingResult.cs
      - SuwayomiSourceMerge/Configuration/Bootstrap/SettingsSelfHealingService.cs
      - SuwayomiSourceMerge/Configuration/Bootstrap/YamlDocumentWriter.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Bootstrap/ConfigurationBootstrapExceptionTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Bootstrap/ConfigurationBootstrapGuardTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Bootstrap/ConfigurationBootstrapServiceTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Bootstrap/ConfigurationBootstrapServiceSceneTagValidationTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Bootstrap/ConfigurationPathSetTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Bootstrap/LegacyMangaEquivalentsMigratorTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Bootstrap/LegacySourcePriorityMigratorTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Bootstrap/SettingsSelfHealingServiceTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Bootstrap/YamlDocumentWriterTests.cs
    entrypoints:
      - symbol: ConfigurationBootstrapException
        kind: class
        path: SuwayomiSourceMerge/Configuration/Bootstrap/ConfigurationBootstrapException.cs
        purpose: Represents bootstrap failures caused by validation errors.
      - symbol: ConfigurationBootstrapResult
        kind: class
        path: SuwayomiSourceMerge/Configuration/Bootstrap/ConfigurationBootstrapResult.cs
        purpose: Returns validated documents, file-state metadata, and migration warnings.
      - symbol: ConfigurationBootstrapService
        kind: class
        path: SuwayomiSourceMerge/Configuration/Bootstrap/ConfigurationBootstrapService.cs
        purpose: Coordinates file creation, legacy migration, and final parse-and-validate loading.
      - symbol: ConfigurationBootstrapService.Bootstrap
        kind: method
        path: SuwayomiSourceMerge/Configuration/Bootstrap/ConfigurationBootstrapService.cs
        purpose: Executes per-file bootstrap decisions and throws on any validation errors.
      - symbol: IConfigurationBootstrapService
        kind: interface
        path: SuwayomiSourceMerge/Configuration/Bootstrap/IConfigurationBootstrapService.cs
        purpose: Defines the canonical bootstrap entrypoint for runtime orchestration.
      - symbol: SettingsSelfHealingService
        kind: class
        path: SuwayomiSourceMerge/Configuration/Bootstrap/SettingsSelfHealingService.cs
        purpose: Fills missing settings keys from defaults while preserving existing values.
    extension_points:
      - how: Add cross-document validation rules that depend on multiple parsed config documents inside bootstrap orchestration.
        symbols: [ConfigurationBootstrapService, ConfigurationBootstrapService.Bootstrap]
        paths: [SuwayomiSourceMerge/Configuration/Bootstrap/ConfigurationBootstrapService.cs]
      - how: Add support for new legacy file formats by adding migrators and wiring them into bootstrap service decisions.
        symbols: [ConfigurationBootstrapService, LegacyMangaEquivalentsMigrator, LegacySourcePriorityMigrator]
        paths: [SuwayomiSourceMerge/Configuration/Bootstrap/ConfigurationBootstrapService.cs, SuwayomiSourceMerge/Configuration/Bootstrap/LegacyMangaEquivalentsMigrator.cs, SuwayomiSourceMerge/Configuration/Bootstrap/LegacySourcePriorityMigrator.cs]
      - how: Extend bootstrap result diagnostics by adding metadata fields to result and warning records consumed by callers.
        symbols: [ConfigurationBootstrapFileState, ConfigurationBootstrapResult, ConfigurationBootstrapWarning]
        paths: [SuwayomiSourceMerge/Configuration/Bootstrap/ConfigurationBootstrapFileState.cs, SuwayomiSourceMerge/Configuration/Bootstrap/ConfigurationBootstrapResult.cs, SuwayomiSourceMerge/Configuration/Bootstrap/ConfigurationBootstrapWarning.cs]
      - how: Extend settings self-heal merge policy by editing the section and field coalescing logic in the self-heal service.
        symbols: [SettingsSelfHealingService]
        paths: [SuwayomiSourceMerge/Configuration/Bootstrap/SettingsSelfHealingService.cs]
      - how: Update canonical config file locations by editing ConfigurationPathSet instead of hardcoding names in callers.
        symbols: [ConfigurationPathSet]
        paths: [SuwayomiSourceMerge/Configuration/Bootstrap/ConfigurationPathSet.cs]
    do_not_reimplement:
      - Canonical legacy manga-equivalents parsing and warning behavior; use LegacyMangaEquivalentsMigrator.
      - Canonical legacy source-priority parsing behavior; use LegacySourcePriorityMigrator.
      - Canonical scene-tag-aware cross-document manga-equivalents validation in bootstrap; use ConfigurationBootstrapService.Bootstrap.
      - Canonical settings self-heal deprecated-scan-timeout compatibility behavior (preserve when present, do not regenerate when absent); use SettingsSelfHealingService.
      - Canonical settings self-heal merge behavior; use SettingsSelfHealingService.
      - Canonical YAML bootstrap write format; use YamlDocumentWriter.
      - Per-file bootstrap orchestration and validation failure policy; use ConfigurationBootstrapService.Bootstrap.
    related: [config-schema-validation, domain-normalization, runtime-host, unit-test-suite]
  - id: config-resolution
    summary: YAML-backed canonical title, source-priority, and override-title resolution services with shared cached normalized lookups.
    tags: [config, priority, resolution, titles]
    paths:
      - SuwayomiSourceMerge/Configuration/Resolution/IMangaEquivalenceService.cs
      - SuwayomiSourceMerge/Configuration/Resolution/IOverrideCanonicalResolver.cs
      - SuwayomiSourceMerge/Configuration/Resolution/ISourcePriorityService.cs
      - SuwayomiSourceMerge/Configuration/Resolution/MangaEquivalenceService.cs
      - SuwayomiSourceMerge/Configuration/Resolution/OverrideCanonicalAdvisory.cs
      - SuwayomiSourceMerge/Configuration/Resolution/OverrideCanonicalResolver.cs
      - SuwayomiSourceMerge/Configuration/Resolution/OverrideTitleCatalogEntry.cs
      - SuwayomiSourceMerge/Configuration/Resolution/SourcePriorityService.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Resolution/MangaEquivalenceServiceTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Resolution/OverrideCanonicalResolverTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Resolution/SourcePriorityServiceTests.cs
    entrypoints:
      - symbol: IMangaEquivalenceService
        kind: interface
        path: SuwayomiSourceMerge/Configuration/Resolution/IMangaEquivalenceService.cs
        purpose: Defines canonical title resolution operations over YAML equivalence mappings.
      - symbol: IOverrideCanonicalResolver
        kind: interface
        path: SuwayomiSourceMerge/Configuration/Resolution/IOverrideCanonicalResolver.cs
        purpose: Defines exact override-title resolution behavior for unmatched equivalence titles.
      - symbol: ISourcePriorityService
        kind: interface
        path: SuwayomiSourceMerge/Configuration/Resolution/ISourcePriorityService.cs
        purpose: Defines source-priority lookup behavior for normalized source names.
      - symbol: MangaEquivalenceService
        kind: class
        path: SuwayomiSourceMerge/Configuration/Resolution/MangaEquivalenceService.cs
        purpose: Builds frozen canonical title lookups from canonical and alias mappings with shared cached key normalization.
      - symbol: OverrideCanonicalResolver
        kind: class
        path: SuwayomiSourceMerge/Configuration/Resolution/OverrideCanonicalResolver.cs
        purpose: Resolves normalized title keys using deterministic untagged-over-tagged canonical arbitration with advisory output for tagged-only preservation.
      - symbol: SourcePriorityService
        kind: class
        path: SuwayomiSourceMerge/Configuration/Resolution/SourcePriorityService.cs
        purpose: Resolves normalized source keys to configured priority indexes with deterministic fallback handling and shared cached normalization.
    extension_points:
      - how: Add additional resolution behavior by extending service interfaces and implementations in the resolution module.
        symbols: [IMangaEquivalenceService, IOverrideCanonicalResolver, ISourcePriorityService, MangaEquivalenceService, OverrideCanonicalResolver, SourcePriorityService]
        paths: [SuwayomiSourceMerge/Configuration/Resolution/IMangaEquivalenceService.cs, SuwayomiSourceMerge/Configuration/Resolution/IOverrideCanonicalResolver.cs, SuwayomiSourceMerge/Configuration/Resolution/ISourcePriorityService.cs, SuwayomiSourceMerge/Configuration/Resolution/MangaEquivalenceService.cs, SuwayomiSourceMerge/Configuration/Resolution/OverrideCanonicalResolver.cs, SuwayomiSourceMerge/Configuration/Resolution/SourcePriorityService.cs]
      - how: Swap scene-tag-aware normalization behavior by injecting alternate ISceneTagMatcher implementations into title-based resolvers.
        symbols: [MangaEquivalenceService, OverrideCanonicalResolver, ISceneTagMatcher]
        paths: [SuwayomiSourceMerge/Configuration/Resolution/MangaEquivalenceService.cs, SuwayomiSourceMerge/Configuration/Resolution/OverrideCanonicalResolver.cs, SuwayomiSourceMerge/Domain/Normalization/ISceneTagMatcher.cs]
      - how: Wire runtime grouping or mount pipelines to these lookup services via interfaces instead of duplicating dictionary-building logic.
        symbols: [IMangaEquivalenceService, IOverrideCanonicalResolver, ISourcePriorityService]
        paths: [SuwayomiSourceMerge/Configuration/Resolution/IMangaEquivalenceService.cs, SuwayomiSourceMerge/Configuration/Resolution/IOverrideCanonicalResolver.cs, SuwayomiSourceMerge/Configuration/Resolution/ISourcePriorityService.cs]
    do_not_reimplement:
      - Canonical manga equivalence canonical/alias lookup construction and conflict checks; use MangaEquivalenceService.
      - Canonical override-title normalized lookup with deterministic untagged-over-tagged canonical arbitration; use OverrideCanonicalResolver.
      - Canonical source-priority normalized token matching and fallback behavior; use SourcePriorityService.
    related: [config-schema-validation, domain-normalization, unit-test-suite]
  - id: config-schema-validation
    summary: Strongly typed YAML schema parsing, defaults, and deterministic validation rules.
    tags: [config, yaml, validation]
    paths:
      - SuwayomiSourceMerge/Configuration/Documents/MangaEquivalentsDocument.cs
      - SuwayomiSourceMerge/Configuration/Documents/MangaEquivalentsDocumentDefaults.cs
      - SuwayomiSourceMerge/Configuration/Documents/SceneTagsDocument.cs
      - SuwayomiSourceMerge/Configuration/Documents/SceneTagsDocumentDefaults.cs
      - SuwayomiSourceMerge/Configuration/Documents/SettingsDocument.cs
      - SuwayomiSourceMerge/Configuration/Documents/SettingsDocumentDefaults.cs
      - SuwayomiSourceMerge/Configuration/Documents/SourcePriorityDocument.cs
      - SuwayomiSourceMerge/Configuration/Documents/SourcePriorityDocumentDefaults.cs
      - SuwayomiSourceMerge/Configuration/Loading/ConfigurationSchemaService.cs
      - SuwayomiSourceMerge/Configuration/Loading/ConfigurationValidationPipeline.cs
      - SuwayomiSourceMerge/Configuration/Loading/ParsedDocument.cs
      - SuwayomiSourceMerge/Configuration/Loading/YamlDocumentParser.cs
      - SuwayomiSourceMerge/Configuration/Validation/IConfigValidator.cs
      - SuwayomiSourceMerge/Configuration/Validation/MangaEquivalentsDocumentValidator.cs
      - SuwayomiSourceMerge/Configuration/Validation/SceneTagsDocumentValidator.cs
      - SuwayomiSourceMerge/Configuration/Validation/SettingsDocumentValidator.cs
      - SuwayomiSourceMerge/Configuration/Validation/SettingsDocumentValidator.PathsAndLists.cs
      - SuwayomiSourceMerge/Configuration/Validation/SourcePriorityDocumentValidator.cs
      - SuwayomiSourceMerge/Configuration/Validation/ValidationError.cs
      - SuwayomiSourceMerge/Configuration/Validation/ValidationKeyNormalizer.cs
      - SuwayomiSourceMerge/Configuration/Validation/ValidationResult.cs
      - docs/config-schema.md
    entrypoints:
      - symbol: ConfigurationSchemaService
        kind: class
        path: SuwayomiSourceMerge/Configuration/Loading/ConfigurationSchemaService.cs
        purpose: Provides strict-runtime and tooling-relaxed parse-and-validate entrypoints for configuration files.
      - symbol: ConfigurationSchemaService.ParseSettingsForRuntime
        kind: method
        path: SuwayomiSourceMerge/Configuration/Loading/ConfigurationSchemaService.cs
        purpose: Parses settings.yml using strict-runtime profile for bootstrap/runtime call sites.
      - symbol: ConfigurationSchemaService.ParseSettingsForTooling
        kind: method
        path: SuwayomiSourceMerge/Configuration/Loading/ConfigurationSchemaService.cs
        purpose: Parses settings.yml with relaxed-tooling profile that tolerates omitted self-healed shutdown cleanup fields.
      - symbol: SettingsDocument
        kind: class
        path: SuwayomiSourceMerge/Configuration/Documents/SettingsDocument.cs
        purpose: Canonical sectioned schema model for settings.yml.
      - symbol: SettingsDocumentDefaults.Create
        kind: method
        path: SuwayomiSourceMerge/Configuration/Documents/SettingsDocumentDefaults.cs
        purpose: Produces default container-oriented settings values.
      - symbol: SettingsDocumentValidator
        kind: class
        path: SuwayomiSourceMerge/Configuration/Validation/SettingsDocumentValidator.cs
        purpose: Enforces deterministic settings validation rules with strict-runtime and relaxed-tooling profile support.
      - symbol: YamlDocumentParser
        kind: class
        path: SuwayomiSourceMerge/Configuration/Loading/YamlDocumentParser.cs
        purpose: Parses YAML into strongly typed documents and reports parser errors.
    extension_points:
      - how: Add new configuration files by introducing typed documents plus dedicated validators wired through the schema service.
        symbols: [ConfigurationSchemaService, IConfigValidator]
        paths: [SuwayomiSourceMerge/Configuration/Loading/ConfigurationSchemaService.cs, SuwayomiSourceMerge/Configuration/Validation/IConfigValidator.cs]
      - how: Adjust generated starter defaults for scene tags, source priority, or manga equivalents by updating their defaults factories consumed during bootstrap creation.
        symbols: [MangaEquivalentsDocumentDefaults.Create, SceneTagsDocumentDefaults.Create, SourcePriorityDocumentDefaults.Create]
        paths: [SuwayomiSourceMerge/Configuration/Documents/MangaEquivalentsDocumentDefaults.cs, SuwayomiSourceMerge/Configuration/Documents/SceneTagsDocumentDefaults.cs, SuwayomiSourceMerge/Configuration/Documents/SourcePriorityDocumentDefaults.cs]
      - how: Extend settings shape by adding fields to document sections, defaults, and validator rules in lockstep.
        symbols: [SettingsDocument, SettingsDocumentDefaults.Create, SettingsDocumentValidator]
        paths: [SuwayomiSourceMerge/Configuration/Documents/SettingsDocument.cs, SuwayomiSourceMerge/Configuration/Documents/SettingsDocumentDefaults.cs, SuwayomiSourceMerge/Configuration/Validation/SettingsDocumentValidator.cs]
      - how: Extend title-key normalization behavior by changing the domain normalizer and keeping the validation adapter in sync.
        symbols: [TitleComparisonNormalizerProvider.Get, ValidationKeyNormalizer]
        paths: [SuwayomiSourceMerge/Configuration/Validation/ValidationKeyNormalizer.cs, SuwayomiSourceMerge/Domain/Normalization/TitleComparisonNormalizerProvider.cs]
      - how: Update schema documentation and validation code catalog when rule sets change.
        symbols: [config-schema.md]
        paths: [docs/config-schema.md]
    do_not_reimplement:
      - Canonical cached matcher-aware title key normalization used by validators; use ValidationKeyNormalizer.NormalizeTitleKey.
      - Canonical default scene-tag list creation used for missing scene_tags.yml bootstrap; use SceneTagsDocumentDefaults.Create.
      - Canonical default starter manga-equivalents mapping for missing manga_equivalents.yml bootstrap; use MangaEquivalentsDocumentDefaults.Create.
      - Canonical default starter source-priority list for missing source_priority.yml bootstrap; use SourcePriorityDocumentDefaults.Create.
      - Canonical YAML parser behavior and parser error codes; use YamlDocumentParser.
      - Document-level parse-and-validate orchestration; use ConfigurationSchemaService.
      - Manga equivalents conflict detection rules; use MangaEquivalentsDocumentValidator.
      - Scene tag matcher-equivalent dedup rules; use SceneTagsDocumentValidator.
      - Settings deprecated scan timeout buffer validation behavior (optional field; range-validated when provided); use SettingsDocumentValidator.
      - Settings logging level and logging section validation rules; use SettingsDocumentValidator.
      - Settings path-overlap safety validation between config and merged roots (including trailing-separator-safe child detection); use SettingsDocumentValidator.ValidateNonOverlappingConfigAndMergedPaths.
      - Settings default log-level baseline (`logging.level: normal`) and schema/docs parity; use SettingsDocumentDefaults.Create and docs/config-schema.md.
      - Settings strict-runtime versus tooling-relaxed shutdown cleanup profile validation behavior; use SettingsDocumentValidator and ConfigurationSchemaService.ParseSettingsForRuntime/ParseSettingsForTooling.
      - Settings validation code map and field constraints; use SettingsDocumentValidator.
      - Source priority dedup validation rules; use SourcePriorityDocumentValidator.
      - YAML parser unknown-key tolerance for schema evolution; use YamlDocumentParser.
    related: [config-resolution, domain-normalization, logging-infrastructure, runtime-host, unit-test-suite]
  - id: domain-normalization
    summary: Data-driven scene-tag matching plus shared cached title/token/source normalization for runtime and validation flows.
    tags: [domain, normalization, titles]
    paths:
      - SuwayomiSourceMerge/Domain/Normalization/CachedTitleComparisonNormalizer.cs
      - SuwayomiSourceMerge/Domain/Normalization/ComparisonTextNormalizer.cs
      - SuwayomiSourceMerge/Domain/Normalization/ISceneTagMatcher.cs
      - SuwayomiSourceMerge/Domain/Normalization/ITitleComparisonNormalizer.cs
      - SuwayomiSourceMerge/Domain/Normalization/SceneTagMatchKey.cs
      - SuwayomiSourceMerge/Domain/Normalization/SceneTagMatchKeyBuilder.cs
      - SuwayomiSourceMerge/Domain/Normalization/SceneTagMatchKeyKind.cs
      - SuwayomiSourceMerge/Domain/Normalization/SceneTagMatcher.cs
      - SuwayomiSourceMerge/Domain/Normalization/SourceNameKeyNormalizer.cs
      - SuwayomiSourceMerge/Domain/Normalization/TitleComparisonNormalizerProvider.cs
      - SuwayomiSourceMerge/Domain/Normalization/TitleKeyNormalizer.cs
      - tests/SuwayomiSourceMerge.UnitTests/Domain/Normalization/CachedTitleComparisonNormalizerTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Domain/Normalization/ComparisonTextNormalizerTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Domain/Normalization/SceneTagMatcherTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Domain/Normalization/SourceNameKeyNormalizerTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Domain/Normalization/TitleKeyNormalizerTests.cs
    entrypoints:
      - symbol: ComparisonTextNormalizer.NormalizeTokenKey
        kind: method
        path: SuwayomiSourceMerge/Domain/Normalization/ComparisonTextNormalizer.cs
        purpose: Builds lower-case ASCII token comparison keys with punctuation-insensitive separator handling.
      - symbol: ISceneTagMatcher
        kind: interface
        path: SuwayomiSourceMerge/Domain/Normalization/ISceneTagMatcher.cs
        purpose: Defines canonical phrase matching for configured scene tags.
      - symbol: SceneTagMatchKeyBuilder.TryCreate
        kind: method
        path: SuwayomiSourceMerge/Domain/Normalization/SceneTagMatchKeyBuilder.cs
        purpose: Produces matcher-equivalent token or punctuation keys for tags and candidates.
      - symbol: SceneTagMatcher
        kind: class
        path: SuwayomiSourceMerge/Domain/Normalization/SceneTagMatcher.cs
        purpose: Normalizes configured scene tags into matcher-equivalent keys and performs deterministic candidate matching.
      - symbol: SourceNameKeyNormalizer.NormalizeSourceKey
        kind: method
        path: SuwayomiSourceMerge/Domain/Normalization/SourceNameKeyNormalizer.cs
        purpose: Produces canonical trim+case-insensitive source-name keys for exclusion matching across merge and rename flows.
      - symbol: TitleComparisonNormalizerProvider.Get
        kind: method
        path: SuwayomiSourceMerge/Domain/Normalization/TitleComparisonNormalizerProvider.cs
        purpose: Returns shared cached normalizers for matcherless and matcher-aware title/token comparison call sites.
      - symbol: TitleKeyNormalizer.NormalizeTitleKey
        kind: method
        path: SuwayomiSourceMerge/Domain/Normalization/TitleKeyNormalizer.cs
        purpose: Builds compact title comparison keys with optional scene-tag suffix stripping.
      - symbol: TitleKeyNormalizer.StripTrailingSceneTagSuffixes
        kind: method
        path: SuwayomiSourceMerge/Domain/Normalization/TitleKeyNormalizer.cs
        purpose: Removes trailing scene-tag suffixes from display titles without applying comparison-key punctuation normalization.
    extension_points:
      - how: Add alternate scene-tag matching policies by implementing the matcher interface and injecting the implementation into validation call sites.
        symbols: [ISceneTagMatcher, MangaEquivalentsDocumentValidator]
        paths: [SuwayomiSourceMerge/Configuration/Validation/MangaEquivalentsDocumentValidator.cs, SuwayomiSourceMerge/Domain/Normalization/ISceneTagMatcher.cs]
      - how: Extend scene-tag key classification and normalization semantics in one place via the shared key builder.
        symbols: [SceneTagMatchKeyBuilder.TryCreate, SceneTagMatcher, SceneTagsDocumentValidator]
        paths: [SuwayomiSourceMerge/Configuration/Validation/SceneTagsDocumentValidator.cs, SuwayomiSourceMerge/Domain/Normalization/SceneTagMatchKeyBuilder.cs, SuwayomiSourceMerge/Domain/Normalization/SceneTagMatcher.cs]
      - how: Reuse shared cached title/token normalization across runtime and validation call sites via the provider.
        symbols: [ITitleComparisonNormalizer, TitleComparisonNormalizerProvider.Get, CachedTitleComparisonNormalizer]
        paths: [SuwayomiSourceMerge/Domain/Normalization/CachedTitleComparisonNormalizer.cs, SuwayomiSourceMerge/Domain/Normalization/ITitleComparisonNormalizer.cs, SuwayomiSourceMerge/Domain/Normalization/TitleComparisonNormalizerProvider.cs]
      - how: Reuse shared punctuation/ASCII/token normalization primitives across validators and domain matchers.
        symbols: [ComparisonTextNormalizer.NormalizeTokenKey, SceneTagMatchKeyBuilder.TryCreate, TitleKeyNormalizer.NormalizeTokenKey]
        paths: [SuwayomiSourceMerge/Domain/Normalization/ComparisonTextNormalizer.cs, SuwayomiSourceMerge/Domain/Normalization/SceneTagMatchKeyBuilder.cs, SuwayomiSourceMerge/Domain/Normalization/TitleKeyNormalizer.cs]
    do_not_reimplement:
      - Canonical ASCII-fold + punctuation-insensitive token key normalization; use ComparisonTextNormalizer.NormalizeTokenKey.
      - Canonical cached matcher-aware and matcherless title/token key normalization provider; use TitleComparisonNormalizerProvider.Get.
      - Canonical configured scene-tag phrase matching implementation; use SceneTagMatcher.
      - Canonical matcher-equivalent scene-tag key derivation; use SceneTagMatchKeyBuilder.TryCreate.
      - Canonical scene-tag matcher contract for normalization consumers; use ISceneTagMatcher.
      - Canonical trim+case-insensitive source-name key normalization for exclusion matching; use SourceNameKeyNormalizer.NormalizeSourceKey.
      - Canonical trailing bracket/delimited scene-tag suffix boundary detection with punctuation-noise fallback; use TitleKeyNormalizer.TryGetTrailingBracketSuffixRange and TitleKeyNormalizer.TryMatchSceneTagCandidate.
      - Canonical display-title trailing scene-tag suffix stripping used by merge canonical fallback naming; use TitleKeyNormalizer.StripTrailingSceneTagSuffixes.
      - Canonical title key normalization for runtime and validation call sites; use TitleKeyNormalizer.NormalizeTitleKey.
    related: [config-bootstrap-migration, config-resolution, config-schema-validation, unit-test-suite]
  - id: infrastructure-branch-planning
    summary: Deterministic branch-link planning with strict path containment for ordering, naming, and mount identity.
    tags: [branching, infrastructure, mergerfs, mounts]
    paths:
      - SuwayomiSourceMerge/Infrastructure/Mounts/BranchIdentityService.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/BranchLinkNamingPolicy.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/IMergerfsBranchPlanningService.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/MergerfsBranchAccessMode.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/MergerfsBranchLinkDefinition.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/MergerfsBranchPlan.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/MergerfsBranchPlanningRequest.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/MergerfsBranchPlanningService.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/MergerfsSourceBranchCandidate.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/OverrideBranchSelectionEntry.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/OverrideBranchSelectionResult.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/OverrideBranchSelectionService.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/PathSafetyPolicy.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/SourceBranchOrderingService.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Mounts/BranchIdentityServiceTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Mounts/BranchLinkNamingPolicyTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Mounts/MergerfsBranchPlanningModelsTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Mounts/MergerfsBranchPlanningServiceTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Mounts/OverrideBranchSelectionResultTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Mounts/OverrideBranchSelectionServiceTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Mounts/PathSafetyPolicyTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Mounts/SourceBranchOrderingServiceTests.cs
    entrypoints:
      - symbol: BranchIdentityService
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Mounts/BranchIdentityService.cs
        purpose: Builds deterministic group ids and desired identity tokens from group keys and branch specifications.
      - symbol: BranchLinkNamingPolicy
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Mounts/BranchLinkNamingPolicy.cs
        purpose: Produces deterministic filesystem-safe link names with bounded label length and hash-truncation for override/source branches.
      - symbol: IMergerfsBranchPlanningService
        kind: interface
        path: SuwayomiSourceMerge/Infrastructure/Mounts/IMergerfsBranchPlanningService.cs
        purpose: Defines the canonical planner contract for mergerfs branch-link plan generation.
      - symbol: MergerfsBranchPlanningService.Plan
        kind: method
        path: SuwayomiSourceMerge/Infrastructure/Mounts/MergerfsBranchPlanningService.cs
        purpose: Emits ordered branch-link definitions, branch specification string, preferred override path, and desired identity token.
      - symbol: OverrideBranchSelectionService
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Mounts/OverrideBranchSelectionService.cs
        purpose: Chooses preferred override branch (`priority` first) with deterministic case-variant dedupe and includes additional existing override title paths.
      - symbol: PathSafetyPolicy
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Mounts/PathSafetyPolicy.cs
        purpose: Centralizes deterministic link-name safety, reusable fully-qualified path normalization, dot-segment escaping, and strict child-only containment for planner paths.
    extension_points:
      - how: Add alternate source-branch ordering and de-duplication policies by extending source ordering service behavior.
        symbols: [ISourcePriorityService, SourceBranchOrderingService, SourceBranchOrderingService.Order]
        paths: [SuwayomiSourceMerge/Configuration/Resolution/ISourcePriorityService.cs, SuwayomiSourceMerge/Infrastructure/Mounts/SourceBranchOrderingService.cs]
      - how: Adjust deterministic identity-token generation by editing group-id and branch-hash rules in branch identity service.
        symbols: [BranchIdentityService, BranchIdentityService.BuildDesiredIdentity]
        paths: [SuwayomiSourceMerge/Infrastructure/Mounts/BranchIdentityService.cs]
      - how: Centralize future dot-segment escaping and containment policy changes in the shared path safety helper.
        symbols: [OverrideBranchSelectionService, PathSafetyPolicy]
        paths: [SuwayomiSourceMerge/Infrastructure/Mounts/OverrideBranchSelectionService.cs, SuwayomiSourceMerge/Infrastructure/Mounts/PathSafetyPolicy.cs]
      - how: Extend override volume selection and additional-branch inclusion policy in override branch selection service.
        symbols: [OverrideBranchSelectionService, OverrideBranchSelectionService.Select]
        paths: [SuwayomiSourceMerge/Infrastructure/Mounts/OverrideBranchSelectionService.cs]
    do_not_reimplement:
      - Canonical deterministic branch identity token generation; use BranchIdentityService.
      - Canonical deterministic branch-link naming with component-length-safe hash-truncation for override/source branches; use BranchLinkNamingPolicy.
      - Canonical deterministic branch-link planning facade output (order, RW/RO, spec, identity); use MergerfsBranchPlanningService.Plan.
      - Canonical override preferred-volume selection with deterministic case-variant representative dedupe + additional-existing-override inclusion; use OverrideBranchSelectionService.
      - Canonical deterministic link-name invalid-character/trailing-dot-space validation plus fully-qualified path normalization, dot-segment escaping, path equality, and strict child-only containment; use PathSafetyPolicy.
      - Canonical source-priority ordering and duplicate-path coalescing for source branches; use SourceBranchOrderingService.Order.
      - Canonical separator-safe title/link validation for planner request and link models; use MergerfsBranchPlanningRequest and MergerfsBranchLinkDefinition.
    related: [config-resolution, infrastructure-mounts, infrastructure-volumes, unit-test-suite]
  - id: infrastructure-metadata
    summary: Override metadata seeding and ComicInfo fallback parsing that produces shell-parity details.json payloads.
    tags: [comicinfo, details, infrastructure, metadata]
    paths:
      - SuwayomiSourceMerge/Infrastructure/Metadata/ComicInfoMetadata.cs
      - SuwayomiSourceMerge/Infrastructure/Metadata/ComicInfoMetadataParser.cs
      - SuwayomiSourceMerge/Infrastructure/Metadata/IComicInfoMetadataParser.cs
      - SuwayomiSourceMerge/Infrastructure/Metadata/IOverrideDetailsService.cs
      - SuwayomiSourceMerge/Infrastructure/Metadata/OverrideDetailsOutcome.cs
      - SuwayomiSourceMerge/Infrastructure/Metadata/OverrideDetailsRequest.cs
      - SuwayomiSourceMerge/Infrastructure/Metadata/OverrideDetailsResult.cs
      - SuwayomiSourceMerge/Infrastructure/Metadata/OverrideDetailsService.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Metadata/ComicInfoMetadataParserTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Metadata/OverrideDetailsServiceTests.cs
    entrypoints:
      - symbol: ComicInfoMetadataParser
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Metadata/ComicInfoMetadataParser.cs
        purpose: Parses ComicInfo files with strict XDocument parsing (including inline Summary break-markup preservation) first and tolerant line-scanner fallback for malformed XML.
      - symbol: ComicInfoMetadataParser.TryParse
        kind: method
        path: SuwayomiSourceMerge/Infrastructure/Metadata/ComicInfoMetadataParser.cs
        purpose: Parses one ComicInfo.xml path into metadata fields used by details generation with race-tolerant read failure handling.
      - symbol: IComicInfoMetadataParser
        kind: interface
        path: SuwayomiSourceMerge/Infrastructure/Metadata/IComicInfoMetadataParser.cs
        purpose: Defines parser contract consumed by override details generation services.
      - symbol: IOverrideDetailsService
        kind: interface
        path: SuwayomiSourceMerge/Infrastructure/Metadata/IOverrideDetailsService.cs
        purpose: Defines canonical details.json ensure contract for seeding and ComicInfo fallback behavior.
      - symbol: OverrideDetailsService
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Metadata/OverrideDetailsService.cs
        purpose: Ensures details.json by checking existing overrides, seeding from sources, and generating from ComicInfo candidates.
      - symbol: OverrideDetailsService.EnsureDetailsJson
        kind: method
        path: SuwayomiSourceMerge/Infrastructure/Metadata/OverrideDetailsService.cs
        purpose: Executes deterministic ensure flow and returns typed outcome metadata for callers.
    extension_points:
      - how: Add alternate ComicInfo parsing strategies by implementing IComicInfoMetadataParser and injecting it into OverrideDetailsService.
        symbols: [ComicInfoMetadataParser, IComicInfoMetadataParser, OverrideDetailsService]
        paths: [SuwayomiSourceMerge/Infrastructure/Metadata/ComicInfoMetadataParser.cs, SuwayomiSourceMerge/Infrastructure/Metadata/IComicInfoMetadataParser.cs, SuwayomiSourceMerge/Infrastructure/Metadata/OverrideDetailsService.cs]
      - how: Adjust details.json output mapping (status code, description mode, genre splitting, field shape) in the override details service.
        symbols: [OverrideDetailsService, OverrideDetailsService.EnsureDetailsJson]
        paths: [SuwayomiSourceMerge/Infrastructure/Metadata/OverrideDetailsService.cs]
      - how: Extend result metadata semantics exposed to callers (for example existence flags) in the override result model and service return construction.
        symbols: [OverrideDetailsResult, OverrideDetailsService.EnsureDetailsJson]
        paths: [SuwayomiSourceMerge/Infrastructure/Metadata/OverrideDetailsResult.cs, SuwayomiSourceMerge/Infrastructure/Metadata/OverrideDetailsService.cs]
      - how: Wire runtime orchestration to metadata ensure behavior through IOverrideDetailsService instead of duplicating seed/generate logic.
        symbols: [IOverrideDetailsService, OverrideDetailsService]
        paths: [SuwayomiSourceMerge/Infrastructure/Metadata/IOverrideDetailsService.cs, SuwayomiSourceMerge/Infrastructure/Metadata/OverrideDetailsService.cs]
    do_not_reimplement:
      - Canonical ComicInfo strict-then-fallback parsing behavior; use ComicInfoMetadataParser.TryParse.
      - Canonical details.json ensure flow (override check, source seed, ComicInfo fallback); use OverrideDetailsService.EnsureDetailsJson.
      - Canonical metadata best-effort IO/race handling for source seeding, candidate traversal, and details writes; use OverrideDetailsService.EnsureDetailsJson.
      - Canonical details.json existence flag semantics returned to callers; use OverrideDetailsResult.DetailsJsonExists.
      - Canonical details.json request validation and description-mode normalization; use OverrideDetailsRequest.
      - Canonical runtime contract for details.json ensure operations; use IOverrideDetailsService.
    related: [runtime-host, unit-test-suite]
  - id: infrastructure-mounts
    summary: Mount snapshots, reconciliation, command apply, and branch-link staging used by production merge runtime.
    tags: [infrastructure, mounts, reconciliation, runtime]
    paths:
      - SuwayomiSourceMerge/Infrastructure/Mounts/BranchLinkStagingService.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/DesiredMountDefinition.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/FindmntMountSnapshotService.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/FindmntSnapshotLineParser.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/IBranchLinkStagingService.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/IMergerfsMountCommandService.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/IMountReconciliationService.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/IMountSnapshotService.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/MergerfsMountCommandService.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/MountActionApplyResult.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/MountReadinessProbeResult.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/MountReconciliationAction.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/MountReconciliationInput.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/MountReconciliationPlan.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/MountReconciliationReason.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/MountReconciliationService.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/MountSnapshot.cs
      - SuwayomiSourceMerge/Infrastructure/Mounts/MountSnapshotWarningPolicy.cs
      - suwayomi_manga_daemon.sh
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Mounts/BranchLinkStagingServiceTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Mounts/FindmntMountSnapshotServiceTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Mounts/FindmntSnapshotLineParserTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Mounts/MergerfsMountCommandServiceTests.MountPointCreation.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Mounts/MergerfsMountCommandServiceTests.ReadinessProbe.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Mounts/MergerfsMountCommandServiceTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Mounts/MountSnapshotWarningPolicyTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Mounts/MountReconciliationServiceTests.cs
    entrypoints:
      - symbol: BranchLinkStagingService
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Mounts/BranchLinkStagingService.cs
        purpose: Stages branch-link directories/symlinks and cleans stale branch-link directories.
      - symbol: FindmntMountSnapshotService
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Mounts/FindmntMountSnapshotService.cs
        purpose: Captures mount snapshots via findmnt and emits deterministic parse/command warnings.
      - symbol: IMergerfsMountCommandService
        kind: interface
        path: SuwayomiSourceMerge/Infrastructure/Mounts/IMergerfsMountCommandService.cs
        purpose: Defines command application contract for mount/remount/unmount reconciliation actions and timeout-bounded mount readiness probing.
      - symbol: IMountReconciliationService
        kind: interface
        path: SuwayomiSourceMerge/Infrastructure/Mounts/IMountReconciliationService.cs
        purpose: Defines planner contract for deterministic mount reconciliation.
      - symbol: MergerfsMountCommandService
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Mounts/MergerfsMountCommandService.cs
        purpose: Applies mount/remount/unmount actions using mergerfs and fusermount fallback chains with mountpoint-ensure, bad-mountpoint retry, timeout-bounded readiness probing, and cleanup-wrapper priorities.
      - symbol: MountReconciliationService
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Mounts/MountReconciliationService.cs
        purpose: Computes deterministic mount/remount/unmount actions using normalized mountpoint key comparisons.
      - symbol: MountSnapshotWarningPolicy.ResolveSeverity
        kind: method
        path: SuwayomiSourceMerge/Infrastructure/Mounts/MountSnapshotWarningPolicy.cs
        purpose: Resolves mount snapshot warning severity from canonical warning codes for downstream safety gates.
    extension_points:
      - how: Add additional snapshot metadata fields by extending MountSnapshotEntry and parser mapping in the findmnt snapshot service.
        symbols: [FindmntMountSnapshotService, FindmntSnapshotLineParser, MountSnapshotEntry]
        paths: [SuwayomiSourceMerge/Infrastructure/Mounts/FindmntMountSnapshotService.cs, SuwayomiSourceMerge/Infrastructure/Mounts/FindmntSnapshotLineParser.cs, SuwayomiSourceMerge/Infrastructure/Mounts/MountSnapshot.cs]
      - how: Adjust legacy shell findmnt pairs-mode fallback policy via probe and wrapper functions.
        symbols: [findmnt_pairs, probe_findmnt_pairs_mode, ro_timeout_findmnt_pairs]
        paths: [suwayomi_manga_daemon.sh]
      - how: Swap branch-link staging behavior by implementing IBranchLinkStagingService and wiring into merge workflow composition.
        symbols: [BranchLinkStagingService, IBranchLinkStagingService]
        paths: [SuwayomiSourceMerge/Infrastructure/Mounts/BranchLinkStagingService.cs, SuwayomiSourceMerge/Infrastructure/Mounts/IBranchLinkStagingService.cs]
      - how: Swap snapshot capture sources (for example mountinfo readers) by implementing IMountSnapshotService and wiring the new service.
        symbols: [FindmntMountSnapshotService, IMountSnapshotService]
        paths: [SuwayomiSourceMerge/Infrastructure/Mounts/FindmntMountSnapshotService.cs, SuwayomiSourceMerge/Infrastructure/Mounts/IMountSnapshotService.cs]
      - how: Wire merge runtime command application through IMergerfsMountCommandService instead of duplicating command chains.
        symbols: [IMergerfsMountCommandService, MergerfsMountCommandService]
        paths: [SuwayomiSourceMerge/Infrastructure/Mounts/IMergerfsMountCommandService.cs, SuwayomiSourceMerge/Infrastructure/Mounts/MergerfsMountCommandService.cs]
    do_not_reimplement:
      - Canonical branch-link staging and stale-directory cleanup semantics; use BranchLinkStagingService.
      - Canonical mount-snapshot warning-code severity mapping used by cleanup safety decisions; use MountSnapshotWarningPolicy.ResolveSeverity.
      - Canonical dangling-entry replacement semantics for branch-link staging (delete-any-entry before relink); use BranchLinkStagingService.StageBranchLinks.
      - Canonical unmount mixed-outcome precedence where non-busy failures are not masked by busy results; use MergerfsMountCommandService.
      - Canonical desired-vs-actual reconciliation decision engine; use MountReconciliationService.Reconcile.
      - Canonical findmnt snapshot capture and parse-warning behavior (including non-throwing parser guards and escape decoding); use FindmntMountSnapshotService.
      - Canonical findmnt escaped-byte decoding must preserve UTF-8 mountpoint text and replace malformed surrogate halves with U+FFFD instead of throwing; use FindmntSnapshotLineParser.DecodeEscapedValue.
      - Canonical legacy shell findmnt pairs-mode compatibility wrapper; use findmnt_pairs.
      - Canonical mount action precondition that ensures mountpoint directories exist before invoking mergerfs; use MergerfsMountCommandService.
      - Canonical mergerfs mount option composition must enforce a default thread cap (`threads=1`) when no explicit threads option is configured; use MergerfsOptionComposer.ComposeMountOptions.
      - Canonical timeout-bounded mounted-path readiness probe command execution and diagnostic mapping; use MergerfsMountCommandService.ProbeMountPointReadiness.
      - Canonical bad-mountpoint retry flow with explicit two-sentence labeled mountpoint-directory-creation failure diagnostics; use MergerfsMountCommandService.
      - Canonical mount/unmount/remount command fallback chains (`fusermount3`, `fusermount`, `umount`); use MergerfsMountCommandService.
      - Canonical normalized mountpoint key matching across desired/actual/forced/stale checks; use MountReconciliationService.Reconcile.
      - Canonical timed legacy shell findmnt pairs-mode wrapper; use ro_timeout_findmnt_pairs.
    related: [application-mounting, infrastructure-branch-planning, infrastructure-processes, runtime-host, unit-test-suite]
  - id: infrastructure-processes
    summary: External process execution with poll-supervised timeout/cancellation, exit-precedence boundary probes, and bounded output capture.
    tags: [infrastructure, process, runtime]
    paths:
      - SuwayomiSourceMerge/Infrastructure/Processes/BoundedOutputBuffer.cs
      - SuwayomiSourceMerge/Infrastructure/Processes/ExternalCommandExecutor.cs
      - SuwayomiSourceMerge/Infrastructure/Processes/ExternalCommandRequest.cs
      - SuwayomiSourceMerge/Infrastructure/Processes/ExternalCommandResult.cs
      - SuwayomiSourceMerge/Infrastructure/Processes/IExternalCommandExecutor.cs
      - SuwayomiSourceMerge/Infrastructure/Processes/IProcessFacade.cs
      - SuwayomiSourceMerge/Infrastructure/Processes/SystemProcessFacade.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Processes/ExternalCommandExecutorTests.cs
    entrypoints:
      - symbol: ExternalCommandExecutor
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Processes/ExternalCommandExecutor.cs
        purpose: Executes external commands with typed outcomes, timeout supervision, and bounded stdout/stderr capture.
      - symbol: ExternalCommandExecutor.Execute
        kind: method
        path: SuwayomiSourceMerge/Infrastructure/Processes/ExternalCommandExecutor.cs
        purpose: Runs one command request and returns deterministic success, timeout, cancellation, or startup-failure results.
      - symbol: ExternalCommandRequest
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Processes/ExternalCommandRequest.cs
        purpose: Defines executable name, arguments, timeout, polling interval, and output-capture limits.
      - symbol: ExternalCommandResult
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Processes/ExternalCommandResult.cs
        purpose: Carries command outcome classification, optional exit code, bounded output, truncation flags, and elapsed duration.
      - symbol: IExternalCommandExecutor
        kind: interface
        path: SuwayomiSourceMerge/Infrastructure/Processes/IExternalCommandExecutor.cs
        purpose: Defines the canonical synchronous command-execution contract for runtime orchestration services.
      - symbol: SystemProcessFacade
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Processes/SystemProcessFacade.cs
        purpose: Adapts System.Diagnostics.Process to the internal process-facade contract used by the executor.
    extension_points:
      - how: Add richer failure classification by extending startup-exception mapping in the command executor.
        symbols: [ExternalCommandExecutor, ExternalCommandFailureKind]
        paths: [SuwayomiSourceMerge/Infrastructure/Processes/ExternalCommandExecutor.cs, SuwayomiSourceMerge/Infrastructure/Processes/ExternalCommandResult.cs]
      - how: Add tool-specific wrapper services by composing typed request builders over IExternalCommandExecutor.
        symbols: [ExternalCommandRequest, IExternalCommandExecutor]
        paths: [SuwayomiSourceMerge/Infrastructure/Processes/ExternalCommandRequest.cs, SuwayomiSourceMerge/Infrastructure/Processes/IExternalCommandExecutor.cs]
      - how: Swap process behavior in tests or alternate hosts by injecting a custom process-facade factory into ExternalCommandExecutor.
        symbols: [ExternalCommandExecutor, IProcessFacade]
        paths: [SuwayomiSourceMerge/Infrastructure/Processes/ExternalCommandExecutor.cs, SuwayomiSourceMerge/Infrastructure/Processes/IProcessFacade.cs]
    do_not_reimplement:
      - Canonical bounded stdout/stderr capture with truncation flags; use ExternalCommandExecutor.
      - Canonical command outcome + failure-kind contract for process execution; use ExternalCommandResult.
      - Canonical poll-supervised timeout/cancellation process handling; use ExternalCommandExecutor.Execute.
      - Canonical timeout/cancellation boundary exit-precedence probes; use ExternalCommandExecutor.TryWaitForExit.
      - Canonical fail-open capture completion handling with trace diagnostics for unexpected non-fatal faults; use ExternalCommandExecutor.WaitForCaptureCompletion.
      - Canonical process-system adapter for real host execution; use SystemProcessFacade.
    related: [infrastructure-mounts, runtime-host, unit-test-suite]
  - id: infrastructure-rename
    summary: Shell-parity chapter rename sanitization and in-memory queue processing with explicit ordered storage, processor-boundary enumeration materialization, and quiet-window checks.
    tags: [infrastructure, queue, rename, runtime]
    paths:
      - SuwayomiSourceMerge/Infrastructure/Rename/ChapterRenameFileSystem.cs
      - SuwayomiSourceMerge/Infrastructure/Rename/ChapterRenameOptions.cs
      - SuwayomiSourceMerge/Infrastructure/Rename/ChapterRenameProcessResult.cs
      - SuwayomiSourceMerge/Infrastructure/Rename/ChapterRenameQueueEntry.cs
      - SuwayomiSourceMerge/Infrastructure/Rename/ChapterRenameQueueProcessor.ProcessPass.cs
      - SuwayomiSourceMerge/Infrastructure/Rename/ChapterRenameQueueProcessor.cs
      - SuwayomiSourceMerge/Infrastructure/Rename/ChapterRenameRescanResult.cs
      - SuwayomiSourceMerge/Infrastructure/Rename/IChapterRenameFileSystem.cs
      - SuwayomiSourceMerge/Infrastructure/Rename/IChapterRenameQueueProcessor.cs
      - SuwayomiSourceMerge/Infrastructure/Rename/IChapterRenameQueueStore.cs
      - SuwayomiSourceMerge/Infrastructure/Rename/IChapterRenameSanitizer.cs
      - SuwayomiSourceMerge/Infrastructure/Rename/InMemoryChapterRenameQueueStore.cs
      - SuwayomiSourceMerge/Infrastructure/Rename/ShellParityChapterRenameSanitizer.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Rename/ChapterRenameModelsAndFileSystemTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Rename/ChapterRenameOptionsTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Rename/ChapterRenameQueueProcessorLoggingTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Rename/ChapterRenameQueueProcessorTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Rename/ChapterRenameQueueProcessorTraversalTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Rename/InMemoryChapterRenameQueueStoreTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Rename/ShellParityChapterRenameSanitizerTests.cs
    entrypoints:
      - symbol: ChapterRenameOptions
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Rename/ChapterRenameOptions.cs
        purpose: Stores validated rename timing and excluded-source settings for queue processing flows.
      - symbol: ChapterRenameOptions.FromSettings
        kind: method
        path: SuwayomiSourceMerge/Infrastructure/Rename/ChapterRenameOptions.cs
        purpose: Builds chapter rename options from parsed settings with fail-fast required-field guards.
      - symbol: ChapterRenameQueueProcessor
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Rename/ChapterRenameQueueProcessor.cs
        purpose: Coordinates enqueue, process-once, and rescan behavior for chapter rename candidates.
      - symbol: ChapterRenameQueueProcessor.ProcessOnce
        kind: method
        path: SuwayomiSourceMerge/Infrastructure/Rename/ChapterRenameQueueProcessor.cs
        purpose: Applies allow-at, quiet-window, collision, and move semantics to queued chapter paths using extracted pass-computation helpers under the store transform lock for current shell-parity correctness.
      - symbol: IChapterRenameQueueProcessor
        kind: interface
        path: SuwayomiSourceMerge/Infrastructure/Rename/IChapterRenameQueueProcessor.cs
        purpose: Defines canonical queue APIs for direct and recursive chapter enqueue plus process-once and rescan operations.
      - symbol: IChapterRenameQueueStore.Transform
        kind: method
        path: SuwayomiSourceMerge/Infrastructure/Rename/IChapterRenameQueueStore.cs
        purpose: Defines atomic queue snapshot-and-replace behavior under one store lock (including callback execution) and requires no queue mutation when transformation callbacks fail.
      - symbol: ShellParityChapterRenameSanitizer
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Rename/ShellParityChapterRenameSanitizer.cs
        purpose: Implements release-group numeric prefix rewrite heuristics for chapter directory names with centralized token sets for shell-boundary and docs-first embedded matching.
    extension_points:
      - how: Add persisted queue backends by implementing the queue-store interface and wiring the processor dependency.
        symbols: [ChapterRenameQueueProcessor, IChapterRenameQueueStore, InMemoryChapterRenameQueueStore]
        paths: [SuwayomiSourceMerge/Infrastructure/Rename/ChapterRenameQueueProcessor.cs, SuwayomiSourceMerge/Infrastructure/Rename/IChapterRenameQueueStore.cs, SuwayomiSourceMerge/Infrastructure/Rename/InMemoryChapterRenameQueueStore.cs]
      - how: Extend chapter rename sanitization rules by updating sanitizer regex policy in one canonical implementation.
        symbols: [IChapterRenameSanitizer, ShellParityChapterRenameSanitizer]
        paths: [SuwayomiSourceMerge/Infrastructure/Rename/IChapterRenameSanitizer.cs, SuwayomiSourceMerge/Infrastructure/Rename/ShellParityChapterRenameSanitizer.cs]
      - how: Wire daemon/watcher flows to queue semantics through the processor interface instead of reimplementing timing logic.
        symbols: [ChapterRenameQueueProcessor, IChapterRenameQueueProcessor]
        paths: [SuwayomiSourceMerge/Infrastructure/Rename/ChapterRenameQueueProcessor.cs, SuwayomiSourceMerge/Infrastructure/Rename/IChapterRenameQueueProcessor.cs]
    do_not_reimplement:
      - Canonical chapter path enqueue gating (depth-3 + excluded-source checks + allow-at delay); use ChapterRenameQueueProcessor.EnqueueChapterPath.
      - Canonical targeted recursive chapter enqueue for source/manga directory events; use IChapterRenameQueueProcessor.EnqueueChaptersUnderSourcePath and IChapterRenameQueueProcessor.EnqueueChaptersUnderMangaPath.
      - Canonical chapter rename rule heuristics (shell-baseline with docs-first embedded chapter-token handling, including embedded abbreviated chapter/episode tokens); use ShellParityChapterRenameSanitizer.
      - Canonical in-memory queue dedupe semantics keyed by normalized path with explicit deterministic ordered-path iteration; use InMemoryChapterRenameQueueStore.
      - Canonical atomic queue transform contract used by processor/store concurrency boundaries, including no-mutation-on-failure semantics; use IChapterRenameQueueStore.Transform.
      - Canonical filesystem adapter enumeration behavior (lazy enumeration with missing-path fast return and benign directory-not-found suppression); use ChapterRenameFileSystem.
      - Canonical queue processing semantics for missing-path grace, quiet windows (including early non-quiet short-circuit and processor-boundary enumeration materialization/exception classification), collision suffixes, best-effort moves under current shell-parity lock scope, and normal summary suppression for empty queue passes; use ChapterRenameQueueProcessor.ProcessOnce.
      - Canonical rename rescan candidate discovery and enqueue merge behavior, including queued-path snapshot duplicate skipping before timestamp lookups; use ChapterRenameQueueProcessor.RescanAndEnqueue.
    related: [config-schema-validation, logging-infrastructure, runtime-host, unit-test-suite]
  - id: infrastructure-volumes
    summary: Container volume discovery for source and override roots with deterministic ordering and warnings.
    tags: [filesystem, infrastructure, volumes]
    paths:
      - SuwayomiSourceMerge/Infrastructure/Volumes/ContainerVolumeDiscoveryResult.cs
      - SuwayomiSourceMerge/Infrastructure/Volumes/ContainerVolumeDiscoveryService.cs
      - SuwayomiSourceMerge/Infrastructure/Volumes/ContainerVolumeFileSystem.cs
      - SuwayomiSourceMerge/Infrastructure/Volumes/IContainerVolumeDiscoveryService.cs
      - SuwayomiSourceMerge/Infrastructure/Volumes/IContainerVolumeFileSystem.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Volumes/ContainerVolumeDiscoveryResultTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Volumes/ContainerVolumeDiscoveryServiceContractTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Volumes/ContainerVolumeDiscoveryServiceTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Volumes/ContainerVolumeFileSystemTests.cs
    entrypoints:
      - symbol: ContainerVolumeDiscoveryResult
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Volumes/ContainerVolumeDiscoveryResult.cs
        purpose: Returns discovered source/override volume paths and non-fatal discovery warnings.
      - symbol: ContainerVolumeDiscoveryService
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Volumes/ContainerVolumeDiscoveryService.cs
        purpose: Discovers direct-child source and override volumes and emits warnings for missing roots.
      - symbol: ContainerVolumeDiscoveryService.Discover
        kind: method
        path: SuwayomiSourceMerge/Infrastructure/Volumes/ContainerVolumeDiscoveryService.cs
        purpose: Validates root paths, enumerates direct-child directories, and returns sorted results.
      - symbol: ContainerVolumeFileSystem
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Volumes/ContainerVolumeFileSystem.cs
        purpose: Provides direct filesystem calls for path normalization and direct-child directory enumeration.
      - symbol: IContainerVolumeDiscoveryService
        kind: interface
        path: SuwayomiSourceMerge/Infrastructure/Volumes/IContainerVolumeDiscoveryService.cs
        purpose: Defines the canonical discovery entrypoint for mapped source and override volumes.
      - symbol: IContainerVolumeFileSystem
        kind: interface
        path: SuwayomiSourceMerge/Infrastructure/Volumes/IContainerVolumeFileSystem.cs
        purpose: Defines filesystem operations consumed by volume discovery for deterministic testing.
    extension_points:
      - how: Adapt internal discovery results to strongly typed public test contracts to keep reusable contract tests compile-time safe.
        symbols: [ContainerVolumeDiscoveryServiceContractTestsBase, IVolumeDiscoveryContractService]
        paths: [tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Volumes/ContainerVolumeDiscoveryServiceContractTests.cs]
      - how: Add additional discovery diagnostics by extending warning/result types consumed by orchestrators.
        symbols: [ContainerVolumeDiscoveryResult, ContainerVolumeDiscoveryWarning]
        paths: [SuwayomiSourceMerge/Infrastructure/Volumes/ContainerVolumeDiscoveryResult.cs]
      - how: Extend discovered root categories by adding interface methods and implementing them in the discovery service.
        symbols: [ContainerVolumeDiscoveryService, IContainerVolumeDiscoveryService]
        paths: [SuwayomiSourceMerge/Infrastructure/Volumes/ContainerVolumeDiscoveryService.cs, SuwayomiSourceMerge/Infrastructure/Volumes/IContainerVolumeDiscoveryService.cs]
      - how: Swap filesystem behavior in tests or future runtime variants by implementing the filesystem interface dependency.
        symbols: [ContainerVolumeDiscoveryService, IContainerVolumeFileSystem]
        paths: [SuwayomiSourceMerge/Infrastructure/Volumes/ContainerVolumeDiscoveryService.cs, SuwayomiSourceMerge/Infrastructure/Volumes/IContainerVolumeFileSystem.cs]
    do_not_reimplement:
      - Canonical contract-test typing adapter for volume discovery; use IVolumeDiscoveryContractService.
      - Canonical missing-root warning semantics for volume discovery; use ContainerVolumeDiscoveryService.Discover.
      - Canonical source/override direct-child enumeration and ordering; use ContainerVolumeDiscoveryService.Discover.
      - Canonical volume discovery filesystem operations contract; use IContainerVolumeFileSystem.
    related: [runtime-host, unit-test-suite]
  - id: infrastructure-watching
    summary: Inotify watcher models and readers for one-shot polling plus persistent progressive monitor sessions with bounded poll buffers.
    tags: [filesystem, infrastructure, inotify, runtime]
    paths:
      - SuwayomiSourceMerge/Infrastructure/Watching/IInotifyEventReader.cs
      - SuwayomiSourceMerge/Infrastructure/Watching/IPersistentInotifyMonitorSession.cs
      - SuwayomiSourceMerge/Infrastructure/Watching/InotifyEventMask.cs
      - SuwayomiSourceMerge/Infrastructure/Watching/InotifyEventRecord.cs
      - SuwayomiSourceMerge/Infrastructure/Watching/InotifyPollResult.cs
      - SuwayomiSourceMerge/Infrastructure/Watching/InotifyWatchStartupMode.cs
      - SuwayomiSourceMerge/Infrastructure/Watching/InotifywaitEventReader.cs
      - SuwayomiSourceMerge/Infrastructure/Watching/PersistentInotifywaitEventReader.BoundedBuffers.cs
      - SuwayomiSourceMerge/Infrastructure/Watching/PersistentInotifywaitEventReader.cs
      - SuwayomiSourceMerge/Infrastructure/Watching/PersistentInotifywaitEventReader.Reconciliation.cs
      - SuwayomiSourceMerge/Infrastructure/Watching/PersistentInotifywaitEventReader.Paths.cs
      - SuwayomiSourceMerge/Infrastructure/Watching/PersistentInotifywaitEventReader.Progressive.cs
      - SuwayomiSourceMerge/Infrastructure/Watching/PersistentInotifywaitEventReader.Session.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Watching/InotifyEventRecordTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Watching/InotifywaitEventReaderTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Watching/PersistentInotifywaitEventReaderTests.BoundedPollBuffers.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Watching/PersistentInotifywaitEventReaderTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Watching/PersistentInotifywaitEventReaderTests.ReconciliationAndTiming.cs
    entrypoints:
      - symbol: IInotifyEventReader
        kind: interface
        path: SuwayomiSourceMerge/Infrastructure/Watching/IInotifyEventReader.cs
        purpose: Defines canonical watcher polling contract over watch roots.
      - symbol: InotifyEventRecord.TryParse
        kind: method
        path: SuwayomiSourceMerge/Infrastructure/Watching/InotifyEventRecord.cs
        purpose: Parses one %w%f|%e output line into a typed event record with unknown-token detection.
      - symbol: InotifyPollResult
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Watching/InotifyPollResult.cs
        purpose: Returns poll outcome, parsed events, and non-fatal polling/parsing warnings.
      - symbol: InotifyWatchStartupMode
        kind: enum
        path: SuwayomiSourceMerge/Infrastructure/Watching/InotifyWatchStartupMode.cs
        purpose: Defines full versus progressive watcher startup semantics consumed by runtime composition.
      - symbol: InotifywaitEventReader
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Watching/InotifywaitEventReader.cs
        purpose: Invokes inotifywait one-shot polls with configurable request-timeout buffer and maps command outcomes (including benign executor timeouts) to typed classifications.
      - symbol: PersistentInotifywaitEventReader
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Watching/PersistentInotifywaitEventReader.cs
        purpose: Runs long-lived inotifywait monitor sessions and batches queued events with progressive deep-watch startup support.
    extension_points:
      - how: Add event-token classification by extending event-mask parsing in record parser.
        symbols: [InotifyEventMask, InotifyEventRecord.TryParse]
        paths: [SuwayomiSourceMerge/Infrastructure/Watching/InotifyEventMask.cs, SuwayomiSourceMerge/Infrastructure/Watching/InotifyEventRecord.cs]
      - how: Adjust inotify command arguments, timeout policy, and output parsing in the concrete reader.
        symbols: [InotifywaitEventReader, InotifywaitEventReader.Poll]
        paths: [SuwayomiSourceMerge/Infrastructure/Watching/InotifywaitEventReader.cs]
      - how: Extend persistent monitor behavior (progressive deep-root discovery, restart backoff, and session batching) in the persistent reader partials.
        symbols: [PersistentInotifywaitEventReader]
        paths: [SuwayomiSourceMerge/Infrastructure/Watching/PersistentInotifywaitEventReader.cs, SuwayomiSourceMerge/Infrastructure/Watching/PersistentInotifywaitEventReader.Reconciliation.cs, SuwayomiSourceMerge/Infrastructure/Watching/PersistentInotifywaitEventReader.Paths.cs, SuwayomiSourceMerge/Infrastructure/Watching/PersistentInotifywaitEventReader.Progressive.cs, SuwayomiSourceMerge/Infrastructure/Watching/PersistentInotifywaitEventReader.Session.cs]
      - how: Swap watcher backends in tests or alternate hosts by implementing IInotifyEventReader.
        symbols: [IInotifyEventReader, InotifywaitEventReader, PersistentInotifywaitEventReader]
        paths: [SuwayomiSourceMerge/Infrastructure/Watching/IInotifyEventReader.cs, SuwayomiSourceMerge/Infrastructure/Watching/IPersistentInotifyMonitorSession.cs, SuwayomiSourceMerge/Infrastructure/Watching/InotifywaitEventReader.cs, SuwayomiSourceMerge/Infrastructure/Watching/PersistentInotifywaitEventReader.cs]
      - how: Wire poll consumers to typed outcome/warning contracts rather than re-parsing raw command output.
        symbols: [InotifyPollResult, IInotifyEventReader]
        paths: [SuwayomiSourceMerge/Infrastructure/Watching/IInotifyEventReader.cs, SuwayomiSourceMerge/Infrastructure/Watching/InotifyPollResult.cs]
    do_not_reimplement:
      - Canonical %w%f|%e line parsing and unknown-token detection; use InotifyEventRecord.TryParse.
      - Canonical inotify event token flag model; use InotifyEventMask.
      - Canonical one-shot inotify command invocation and timeout classification; use InotifywaitEventReader.Poll.
      - Canonical persistent inotify monitor orchestration with progressive deep-watch startup, desired-session pruning, and bounded restart backoff; use PersistentInotifywaitEventReader.
      - Canonical persistent inotify monitor session IO/exit observation should avoid per-session Task.Run thread pinning; use PersistentInotifywaitEventReader.InotifyMonitorSession.
      - Canonical persistent inotify poll result bounding and drop-oldest overflow signaling must retain overflow summary warnings across early returns and include summary-eviction warning drops in dropped-warning diagnostics; use PersistentInotifywaitEventReader.
      - Canonical progressive deep-session startup budget semantics are per start phase (pre-wait/post-wait), not single-phase per entire poll; use PersistentInotifywaitEventReader.
      - Canonical watcher startup mode contract (`full` and `progressive`); use InotifyWatchStartupMode.
      - Canonical typed poll outcome and warning contract; use InotifyPollResult.
    related: [application-watching, infrastructure-processes, runtime-host, unit-test-suite]
  - id: integration-test-suite
    summary: Docker-based end-to-end integration suite validating container runtime startup, capability, Debian-semantic pinned-upstream mergerfs package version checks, and failure semantics.
    tags: [docker, integration-tests, runtime, xunit]
    paths:
      - tests/SuwayomiSourceMerge.IntegrationTests/ContainerRuntimeEndToEndTests.Capabilities.cs
      - tests/SuwayomiSourceMerge.IntegrationTests/ContainerRuntimeEndToEndTests.EntrypointFuseDevice.cs
      - tests/SuwayomiSourceMerge.IntegrationTests/ContainerRuntimeEndToEndTests.EntrypointLogPath.cs
      - tests/SuwayomiSourceMerge.IntegrationTests/ContainerRuntimeEndToEndTests.EntrypointOwnershipSafety.cs
      - tests/SuwayomiSourceMerge.IntegrationTests/ContainerRuntimeEndToEndTests.SignalHandling.cs
      - tests/SuwayomiSourceMerge.IntegrationTests/ContainerRuntimeEndToEndTests.cs
      - tests/SuwayomiSourceMerge.IntegrationTests/DockerAssertionsBehaviorTests.cs
      - tests/SuwayomiSourceMerge.IntegrationTests/DockerCommandRunnerBehaviorTests.cs
      - tests/SuwayomiSourceMerge.IntegrationTests/README.md
      - tests/SuwayomiSourceMerge.IntegrationTests/SuwayomiSourceMerge.IntegrationTests.csproj
      - tests/SuwayomiSourceMerge.IntegrationTests/TestInfrastructure/ContainerFixtureWorkspace.cs
      - tests/SuwayomiSourceMerge.IntegrationTests/TestInfrastructure/DockerAssertions.cs
      - tests/SuwayomiSourceMerge.IntegrationTests/TestInfrastructure/DockerCommandResult.cs
      - tests/SuwayomiSourceMerge.IntegrationTests/TestInfrastructure/DockerCommandRunner.cs
      - tests/SuwayomiSourceMerge.IntegrationTests/TestInfrastructure/DockerIntegrationCollection.cs
      - tests/SuwayomiSourceMerge.IntegrationTests/TestInfrastructure/DockerIntegrationFixture.cs
    entrypoints:
      - symbol: ContainerRuntimeEndToEndTests
        kind: class
        path: tests/SuwayomiSourceMerge.IntegrationTests/ContainerRuntimeEndToEndTests.cs
        purpose: Verifies expected, edge, and failure Docker runtime behavior for the daemon container image, including entrypoint and capability regression scenarios.
      - symbol: DockerAssertions
        kind: class
        path: tests/SuwayomiSourceMerge.IntegrationTests/TestInfrastructure/DockerAssertions.cs
        purpose: Provides deterministic polling and shared-read file assertion helpers with timeout diagnostics preserving last read exceptions.
      - symbol: DockerAssertions.CountFileLinesMatching
        kind: method
        path: tests/SuwayomiSourceMerge.IntegrationTests/TestInfrastructure/DockerAssertions.cs
        purpose: Counts matching log lines with shared-read semantics and bounded retries for transient IO/share failures.
      - symbol: DockerAssertionsBehaviorTests
        kind: class
        path: tests/SuwayomiSourceMerge.IntegrationTests/DockerAssertionsBehaviorTests.cs
        purpose: Verifies expected, edge, and failure polling behavior for DockerAssertions timeout diagnostics.
      - symbol: DockerCommandRunner
        kind: class
        path: tests/SuwayomiSourceMerge.IntegrationTests/TestInfrastructure/DockerCommandRunner.cs
        purpose: Wraps Docker CLI build/run/inspect/logs commands with typed failure diagnostics, bounded timeout teardown, and full output-drain handling after confirmed process exit.
      - symbol: DockerIntegrationFixture
        kind: class
        path: tests/SuwayomiSourceMerge.IntegrationTests/TestInfrastructure/DockerIntegrationFixture.cs
        purpose: Ensures Docker daemon availability, builds one shared image, and performs best-effort image cleanup on teardown.
      - symbol: SuwayomiSourceMerge.IntegrationTests.csproj
        kind: file
        path: tests/SuwayomiSourceMerge.IntegrationTests/SuwayomiSourceMerge.IntegrationTests.csproj
        purpose: Defines integration test project dependencies and test-framework wiring.
    extension_points:
      - how: Add new end-to-end runtime scenarios by extending container test cases in ContainerRuntimeEndToEndTests.
        symbols: [ContainerRuntimeEndToEndTests]
        paths: [tests/SuwayomiSourceMerge.IntegrationTests/ContainerRuntimeEndToEndTests.Capabilities.cs, tests/SuwayomiSourceMerge.IntegrationTests/ContainerRuntimeEndToEndTests.EntrypointFuseDevice.cs, tests/SuwayomiSourceMerge.IntegrationTests/ContainerRuntimeEndToEndTests.EntrypointLogPath.cs, tests/SuwayomiSourceMerge.IntegrationTests/ContainerRuntimeEndToEndTests.EntrypointOwnershipSafety.cs, tests/SuwayomiSourceMerge.IntegrationTests/ContainerRuntimeEndToEndTests.SignalHandling.cs, tests/SuwayomiSourceMerge.IntegrationTests/ContainerRuntimeEndToEndTests.cs]
      - how: Expand Docker CLI orchestration coverage by adding helpers to DockerCommandRunner and DockerCommandResult.
        symbols: [DockerCommandResult, DockerCommandRunner]
        paths: [tests/SuwayomiSourceMerge.IntegrationTests/TestInfrastructure/DockerCommandResult.cs, tests/SuwayomiSourceMerge.IntegrationTests/TestInfrastructure/DockerCommandRunner.cs]
      - how: Tune shared image-build lifecycle and daemon preflight behavior through DockerIntegrationFixture.
        symbols: [DockerIntegrationFixture]
        paths: [tests/SuwayomiSourceMerge.IntegrationTests/TestInfrastructure/DockerIntegrationFixture.cs]
      - how: Tune wait/retry assertion behavior for eventual log/state checks in DockerAssertions.
        symbols: [DockerAssertions]
        paths: [tests/SuwayomiSourceMerge.IntegrationTests/TestInfrastructure/DockerAssertions.cs]
    do_not_reimplement:
      - Canonical container test workspace and mock-tool filesystem layout; use ContainerFixtureWorkspace.
      - Canonical stale-merged ownership startup-regression harness (recursive-avoidance plus warning-only child-repair failures) using argv-aware mock argument matching; use ContainerRuntimeEndToEndTests.
      - Canonical entrypoint symlink-safety ownership hardening harness (merged-child and daemon-log chown skips); use ContainerRuntimeEndToEndTests in `ContainerRuntimeEndToEndTests.EntrypointOwnershipSafety.cs`.
      - Canonical entrypoint non-root FUSE-device-access fail-fast harness; use ContainerRuntimeEndToEndTests.EntrypointFuseDevice.
      - Canonical entrypoint non-root FUSE preflight validation that rejects non-character-device `FUSE_DEVICE_PATH` values; use ContainerRuntimeEndToEndTests.EntrypointFuseDevice.
      - Canonical entrypoint trusted-root log ownership guard that skips privileged chown outside `/ssm/config`; use ContainerRuntimeEndToEndTests.EntrypointLogPath.
      - Canonical SIGTERM shutdown integration harness that verifies graceful cleanup/unmount behavior during container stop; use ContainerRuntimeEndToEndTests.SignalHandling.
      - Canonical image capability regression harness validating baked cap_sys_admin on mergerfs/fusermount3, Debian-version-aware pinned-upstream mergerfs package validation, build-only curl removal, and stripped-image negative controls; use ContainerRuntimeEndToEndTests in `ContainerRuntimeEndToEndTests.Capabilities.cs`.
      - Canonical deterministic wait-loop assertions for integration checks; use DockerAssertions.
      - Canonical Docker CLI command execution and diagnostics wrapper; use DockerCommandRunner.
      - Canonical Docker integration image build, daemon preflight, and teardown image cleanup fixture setup; use DockerIntegrationFixture.
      - Canonical shared-read log-line counting with transient retry semantics; use DockerAssertions.CountFileLinesMatching.
    related: [container-runtime-assets, infrastructure-watching, runtime-host, unit-test-suite]
  - id: logging-infrastructure
    summary: Structured log formatting, normal/debug threshold filtering, and file rolling/retention for diagnostics.
    tags: [diagnostics, logging, runtime]
    paths:
      - SuwayomiSourceMerge/Infrastructure/Logging/ILogSink.cs
      - SuwayomiSourceMerge/Infrastructure/Logging/ISsmLogger.cs
      - SuwayomiSourceMerge/Infrastructure/Logging/ISsmLoggerFactory.cs
      - SuwayomiSourceMerge/Infrastructure/Logging/LogEvent.cs
      - SuwayomiSourceMerge/Infrastructure/Logging/LogFilePathPolicy.cs
      - SuwayomiSourceMerge/Infrastructure/Logging/LogLevel.cs
      - SuwayomiSourceMerge/Infrastructure/Logging/LogLevelParser.cs
      - SuwayomiSourceMerge/Infrastructure/Logging/RollingFileLogger.cs
      - SuwayomiSourceMerge/Infrastructure/Logging/RollingFileSink.cs
      - SuwayomiSourceMerge/Infrastructure/Logging/SsmLoggerFactory.cs
      - SuwayomiSourceMerge/Infrastructure/Logging/StructuredTextLogFormatter.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Logging/LogEventTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Logging/LogFilePathPolicyTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Logging/LogLevelParserTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Logging/RollingFileLoggerTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Logging/RollingFileSinkTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Logging/SsmLoggerFactoryTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Logging/StructuredTextLogFormatterTests.cs
    entrypoints:
      - symbol: ISsmLogger
        kind: interface
        path: SuwayomiSourceMerge/Infrastructure/Logging/ISsmLogger.cs
        purpose: Defines canonical structured log emission methods and level checks.
      - symbol: LogFilePathPolicy
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Logging/LogFilePathPolicy.cs
        purpose: Enforces deterministic log-file-name safety rules (invalid chars, trailing dot/space, reserved Windows device names on all platforms) and root containment.
      - symbol: LogLevelParser
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Logging/LogLevelParser.cs
        purpose: Centralizes logging-level token parsing with non-throwing TryParse and shared supported-token display.
      - symbol: RollingFileLogger
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Logging/RollingFileLogger.cs
        purpose: Applies level filtering (including non-emitting LogLevel.None sentinel handling) and fail-open sink writes with stderr fallback.
      - symbol: RollingFileSink
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Logging/RollingFileSink.cs
        purpose: Persists structured lines to disk with size-based rolling and retention.
      - symbol: SsmLoggerFactory
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Logging/SsmLoggerFactory.cs
        purpose: Maps validated settings to configured logger instances and level behavior.
      - symbol: StructuredTextLogFormatter
        kind: class
        path: SuwayomiSourceMerge/Infrastructure/Logging/StructuredTextLogFormatter.cs
        purpose: Formats log events into deterministic single-line key/value text output.
    extension_points:
      - how: Add new sink targets by implementing the sink contract and wiring them via the logger factory.
        symbols: [ILogSink, SsmLoggerFactory]
        paths: [SuwayomiSourceMerge/Infrastructure/Logging/ILogSink.cs, SuwayomiSourceMerge/Infrastructure/Logging/SsmLoggerFactory.cs]
      - how: Change structured line rendering and escaping behavior in the text formatter.
        symbols: [StructuredTextLogFormatter]
        paths: [SuwayomiSourceMerge/Infrastructure/Logging/StructuredTextLogFormatter.cs]
      - how: Update level-threshold behavior and fallback write semantics in the rolling logger.
        symbols: [ISsmLogger, RollingFileLogger]
        paths: [SuwayomiSourceMerge/Infrastructure/Logging/ISsmLogger.cs, SuwayomiSourceMerge/Infrastructure/Logging/RollingFileLogger.cs]
      - how: Update retention and rollover file policies in the rolling file sink.
        symbols: [RollingFileSink]
        paths: [SuwayomiSourceMerge/Infrastructure/Logging/RollingFileSink.cs]
    do_not_reimplement:
      - Canonical config-to-logger construction; use SsmLoggerFactory.
      - Canonical log-file name/path safety checks; use LogFilePathPolicy.
      - Canonical level filtering and sink fault fallback behavior; use RollingFileLogger.
      - Canonical non-emitting handling for LogLevel.None sentinel values; use RollingFileLogger.
      - Canonical normal-level semantics (ordered between debug and warning) and formatter token mapping (`level=normal`); use LogLevel and StructuredTextLogFormatter.
      - Canonical logging-level token parsing shared by validation and runtime; use LogLevelParser.
      - Canonical non-throw probing for logging-level tokens; use LogLevelParser.TryParse.
      - Canonical structured text line format and escaping policy; use StructuredTextLogFormatter.
      - Canonical size-based rollover and retained archive handling; use RollingFileSink.
    related: [application-hosting, config-schema-validation, unit-test-suite]
  - id: runtime-host
    summary: Console host, runtime configuration, and top-level public/developer runtime usage documentation.
    tags: [runtime, host, console]
    paths:
      - DEVELOPMENT.md
      - README.md
      - SuwayomiSourceMerge/Program.cs
      - SuwayomiSourceMerge/SuwayomiSourceMerge.csproj
      - unraid/templates/my-SuwayomiSourceMerge.xml
    entrypoints:
      - symbol: DEVELOPMENT.md
        kind: file
        path: DEVELOPMENT.md
        purpose: Captures contributor-focused runtime baseline, architecture constraints, and test guidance.
      - symbol: Program.cs
        kind: file
        path: SuwayomiSourceMerge/Program.cs
        purpose: Current runtime entrypoint for the console application.
      - symbol: ProgramEntryPoint.Run
        kind: method
        path: SuwayomiSourceMerge/Program.cs
        purpose: Executes the composed application host using the canonical container config root.
      - symbol: README.md
        kind: file
        path: README.md
        purpose: Captures public usage guidance including Docker Compose, Unraid direct-disk mapping, rshared merged-bind requirements, CI, and bare-metal runtime instructions.
      - symbol: SuwayomiSourceMerge.csproj
        kind: file
        path: SuwayomiSourceMerge/SuwayomiSourceMerge.csproj
        purpose: Defines runtime target framework and build behavior.
      - symbol: unraid/templates/my-SuwayomiSourceMerge.xml
        kind: file
        path: unraid/templates/my-SuwayomiSourceMerge.xml
        purpose: Defines an Unraid Community Apps template with required FUSE/security flags and source/override path slots through disk10.
    extension_points:
      - how: Add new runtime orchestration by introducing services and invoking them from Program.cs.
        symbols: [Program.cs]
        paths: [SuwayomiSourceMerge/Program.cs]
      - how: Add project-level runtime/build settings in the application project file.
        symbols: [SuwayomiSourceMerge.csproj]
        paths: [SuwayomiSourceMerge/SuwayomiSourceMerge.csproj]
      - how: Document runtime operation and deployment guidance in README.md, DEVELOPMENT.md, and the Unraid template.
        symbols: [README.md, DEVELOPMENT.md, unraid/templates/my-SuwayomiSourceMerge.xml]
        paths: [README.md, DEVELOPMENT.md, unraid/templates/my-SuwayomiSourceMerge.xml]
    do_not_reimplement:
      - Canonical contributor runtime baseline documentation; use DEVELOPMENT.md.
      - Canonical default startup config root handoff to application host; use ProgramEntryPoint.Run.
      - Canonical public runtime usage and deployment documentation; use README.md.
      - Canonical Unraid Community Apps template wiring for this runtime; use unraid/templates/my-SuwayomiSourceMerge.xml.
      - Console entrypoint bootstrapping; extend Program.cs.
      - Runtime project configuration root; extend SuwayomiSourceMerge.csproj.
      - Warning policy overrides in app project; keep centralized in Directory.Build.props.
    related: [application-hosting, build-and-quality, shared-test-support, unit-test-suite]
  - id: shared-test-support
    summary: Reusable testing helpers shared across test projects.
    tags: [tests, support, shared]
    paths:
      - tests/SuwayomiSourceMerge.Testing/Class1.cs
      - tests/SuwayomiSourceMerge.Testing/SuwayomiSourceMerge.Testing.csproj
    entrypoints:
      - symbol: SuwayomiSourceMerge.Testing.csproj
        kind: file
        path: tests/SuwayomiSourceMerge.Testing/SuwayomiSourceMerge.Testing.csproj
        purpose: Shared test-support project referenced by test suites.
      - symbol: TestPathHelper
        kind: class
        path: tests/SuwayomiSourceMerge.Testing/Class1.cs
        purpose: Canonical helper class for common test path operations.
      - symbol: TestPathHelper.Combine
        kind: method
        path: tests/SuwayomiSourceMerge.Testing/Class1.cs
        purpose: Combines path segments for tests using platform separators.
    extension_points:
      - how: Add reusable fixtures/utilities in the shared support project for broad test reuse.
        symbols: [TestPathHelper]
        paths: [tests/SuwayomiSourceMerge.Testing/Class1.cs]
      - how: Expand shared support dependencies via the test-support project file.
        symbols: [SuwayomiSourceMerge.Testing.csproj]
        paths: [tests/SuwayomiSourceMerge.Testing/SuwayomiSourceMerge.Testing.csproj]
    do_not_reimplement:
      - Shared path composition helper; use TestPathHelper.Combine.
      - Shared test helper project root; use SuwayomiSourceMerge.Testing.csproj.
    related: [runtime-host, unit-test-suite]
  - id: unit-test-suite
    summary: Primary xUnit project covering config, runtime orchestration, and infrastructure behavior with mutation scaffolding.
    tags: [tests, xunit, validation]
    paths:
      - tests/SuwayomiSourceMerge.UnitTests/Application/Cancellation/CancellationClassificationTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Hosting/ApplicationHostTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Hosting/SceneTagConfigurationAdvisorTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Mounting/MergeMountWorkflowTests.CleanupMergedRoot.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Mounting/MergeMountWorkflowTests.DegradedVisibilityAndOverrideTitles.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Mounting/MergeMountWorkflowTests.FailFastMountFailures.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Mounting/MergeMountWorkflowTests.Fakes.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Mounting/MergeMountWorkflowTests.OutcomesAndCancellation.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Mounting/MergeMountWorkflowTests.WarningDiagnostics.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Mounting/MergeMountWorkflowTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Supervision/DaemonSupervisorOptionsTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Supervision/ConsoleSupervisorSignalRegistrarTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Supervision/DaemonSupervisorTests.StackTraceLogging.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Supervision/DaemonSupervisorTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Supervision/FilesystemEventDaemonWorkerTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Watching/FilesystemEventTriggerOptionsTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Watching/FilesystemEventTriggerPipelineIntegrationTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Watching/FilesystemEventTriggerPipelineTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Watching/MergeScanRequestCoalescerTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Watching/NoOpMergeScanRequestHandlerTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Application/Watching/ProductionMergeScanRequestHandlerTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Bootstrap/ConfigurationBootstrapExceptionTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Bootstrap/ConfigurationBootstrapGuardTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Bootstrap/ConfigurationBootstrapServiceTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Bootstrap/ConfigurationBootstrapServiceSceneTagValidationTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Bootstrap/ConfigurationPathSetTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Bootstrap/LegacyMangaEquivalentsMigratorTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Bootstrap/LegacySourcePriorityMigratorTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Bootstrap/SettingsSelfHealingServiceTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Bootstrap/YamlDocumentWriterTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/ConfigurationDocumentDefaultsTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/ConfigurationSchemaServiceFactory.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/ConfigurationTestData.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Loading/ConfigurationSchemaServiceTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Loading/ConfigurationValidationPipelineTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/MangaEquivalentsSchemaTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Resolution/MangaEquivalenceServiceTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Resolution/OverrideCanonicalResolverTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Resolution/SourcePriorityServiceTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/SceneTagsSchemaTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/SettingsDocumentDefaultsTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/SettingsSchemaTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/SourcePrioritySchemaTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Validation/MangaEquivalentsDocumentValidatorTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Validation/SceneTagsDocumentValidatorTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Validation/SettingsDocumentValidatorTests.PathOverlap.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Validation/SettingsDocumentValidatorTests.RuntimeMountFailureThreshold.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Validation/SettingsDocumentValidatorTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Validation/SourcePriorityDocumentValidatorTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Validation/ValidationKeyNormalizerPropertyTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Validation/ValidationKeyNormalizerTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/Validation/ValidationResultTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/YamlDocumentParserPropertyTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Configuration/YamlDocumentParserTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Domain/Normalization/CachedTitleComparisonNormalizerTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Domain/Normalization/ComparisonTextNormalizerTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Domain/Normalization/SceneTagMatcherTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Domain/Normalization/SourceNameKeyNormalizerTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Domain/Normalization/TitleKeyNormalizerTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Logging/LogEventTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Logging/LogFilePathPolicyTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Logging/LogLevelParserTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Logging/RollingFileLoggerTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Logging/RollingFileSinkTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Logging/SsmLoggerFactoryTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Logging/StructuredTextLogFormatterTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Metadata/ComicInfoMetadataParserTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Metadata/OverrideDetailsServiceTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Mounts/BranchLinkStagingServiceTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Mounts/MergerfsMountCommandServiceTests.MountPointCreation.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Mounts/MergerfsMountCommandServiceTests.ReadinessProbe.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Mounts/MergerfsMountCommandServiceTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Mounts/MountSnapshotWarningPolicyTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Volumes/ContainerVolumeDiscoveryResultTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Volumes/ContainerVolumeDiscoveryServiceContractTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Volumes/ContainerVolumeDiscoveryServiceTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Volumes/ContainerVolumeFileSystemTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Watching/InotifyEventRecordTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Watching/InotifywaitEventReaderTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Infrastructure/Watching/PersistentInotifywaitEventReaderTests.BoundedPollBuffers.cs
      - tests/SuwayomiSourceMerge.UnitTests/ProgramEntryPointTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Repository/LineEndingPolicyTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/Repository/NamingConventionPolicyTests.cs
      - tests/SuwayomiSourceMerge.UnitTests/README.md
      - tests/SuwayomiSourceMerge.UnitTests/stryker-config.json
      - tests/SuwayomiSourceMerge.UnitTests/SuwayomiSourceMerge.UnitTests.csproj
      - tests/SuwayomiSourceMerge.UnitTests/TestInfrastructure/PathTestUtilities.cs
      - tests/SuwayomiSourceMerge.UnitTests/TestInfrastructure/RecordingLogger.cs
      - tests/SuwayomiSourceMerge.UnitTests/TestInfrastructure/RepositoryRootLocator.cs
      - tests/SuwayomiSourceMerge.UnitTests/TestInfrastructure/SceneTagMatcherTestDoubles.cs
      - tests/SuwayomiSourceMerge.UnitTests/TestInfrastructure/TemporaryDirectory.cs
      - tests/SuwayomiSourceMerge.UnitTests/UnitTest1.cs
    entrypoints:
      - symbol: ConfigurationBootstrapServiceTests
        kind: class
        path: tests/SuwayomiSourceMerge.UnitTests/Configuration/Bootstrap/ConfigurationBootstrapServiceTests.cs
        purpose: Verifies expected, edge, and failure behavior for bootstrap and legacy migration.
      - symbol: ConfigurationValidationPipelineTests
        kind: class
        path: tests/SuwayomiSourceMerge.UnitTests/Configuration/Loading/ConfigurationValidationPipelineTests.cs
        purpose: Verifies parse/validate orchestration, guard clauses, and validator exception propagation.
      - symbol: LineEndingPolicyTests
        kind: class
        path: tests/SuwayomiSourceMerge.UnitTests/Repository/LineEndingPolicyTests.cs
        purpose: Verifies tracked repository text blobs remain LF-only and fail on CRLF/lone-CR drift.
      - symbol: SettingsSchemaTests
        kind: class
        path: tests/SuwayomiSourceMerge.UnitTests/Configuration/SettingsSchemaTests.cs
        purpose: Verifies expected, edge, and failure validation behavior for settings schema.
      - symbol: stryker-config.json
        kind: file
        path: tests/SuwayomiSourceMerge.UnitTests/stryker-config.json
        purpose: Defines mutation-testing scope and threshold break values for configuration code.
      - symbol: SuwayomiSourceMerge.UnitTests.csproj
        kind: file
        path: tests/SuwayomiSourceMerge.UnitTests/SuwayomiSourceMerge.UnitTests.csproj
        purpose: Defines xUnit + FsCheck test framework dependencies and project references.
      - symbol: ValidationKeyNormalizerPropertyTests
        kind: class
        path: tests/SuwayomiSourceMerge.UnitTests/Configuration/Validation/ValidationKeyNormalizerPropertyTests.cs
        purpose: Verifies key-normalization invariants with property-based tests.
    extension_points:
      - how: Add new deterministic unit tests in the unit test project and centralize reusable fixtures/helpers for reuse.
        symbols: [ProjectLayoutTests, SuwayomiSourceMerge.UnitTests.csproj]
        paths: [tests/SuwayomiSourceMerge.UnitTests/Configuration/ConfigurationTestData.cs, tests/SuwayomiSourceMerge.UnitTests/Repository/LineEndingPolicyTests.cs, tests/SuwayomiSourceMerge.UnitTests/SuwayomiSourceMerge.UnitTests.csproj, tests/SuwayomiSourceMerge.UnitTests/TestInfrastructure/PathTestUtilities.cs, tests/SuwayomiSourceMerge.UnitTests/TestInfrastructure/RecordingLogger.cs, tests/SuwayomiSourceMerge.UnitTests/TestInfrastructure/SceneTagMatcherTestDoubles.cs, tests/SuwayomiSourceMerge.UnitTests/TestInfrastructure/TemporaryDirectory.cs, tests/SuwayomiSourceMerge.UnitTests/UnitTest1.cs]
      - how: Adjust mutation-test scope and score gates in the stryker configuration file.
        symbols: [stryker-config.json]
        paths: [tests/SuwayomiSourceMerge.UnitTests/stryker-config.json]
      - how: Extend framework/test-runner dependencies in the unit test project file.
        symbols: [SuwayomiSourceMerge.UnitTests.csproj]
        paths: [tests/SuwayomiSourceMerge.UnitTests/SuwayomiSourceMerge.UnitTests.csproj]
    do_not_reimplement:
      - Baseline test-harness smoke coverage; extend ProjectLayoutTests.
      - Canonical unit-test project wiring; use SuwayomiSourceMerge.UnitTests.csproj.
      - Canonical YAML schema validation test scenarios; extend configuration schema test classes.
      - Host lifecycle and stderr fallback coverage; extend ApplicationHostTests.
      - Logging formatter/filter/rolling behavior coverage; extend Infrastructure/Logging test classes.
      - Mutation-test scope and threshold gates; use stryker-config.json.
      - Repository LF line-ending drift guard; extend LineEndingPolicyTests.
      - Repository-policy test root discovery in unit tests; use RepositoryRootLocator.FindRepositoryRoot.
    related: [application-hosting, application-mounting, application-supervision, application-watching, build-and-quality, config-schema-validation, infrastructure-mounts, infrastructure-watching, logging-infrastructure, runtime-host, shared-test-support]
